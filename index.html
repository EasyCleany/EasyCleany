<!doctype html>
<html lang="de">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Easy Cleany – Endreinigung Anfrage</title>

  <!-- OPTIONAL (PDF Export) -->
  <script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/jspdf@2.5.1/dist/jspdf.umd.min.js"></script>

  <style>
    :root{
      --bg:#f6faf9;
      --card:#ffffff;
      --text:#0f1a17;
      --muted:#5a6b66;
      --line:#e6eeeb;
      --accent:#1f6f68;
      --accent2:#0e4f4a; /* dunkleres blaugrün */
      --soft:rgba(31,111,104,0.10);
      --soft2:rgba(31,111,104,0.06);
      --radius:18px;
      --shadow: 0 12px 30px rgba(16,24,40,.08);
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial, "Noto Sans", sans-serif;
      background:var(--bg);
      color:var(--text);
    }
    .container{max-width:1200px;margin:0 auto;padding:18px;}
    .card{
      background:var(--card);
      border:1px solid var(--line);
      border-radius:var(--radius);
      box-shadow:var(--shadow);
      padding:18px;
    }
    .hidden{display:none !important;}

    /* Sticky header */
    .sticky{
      position:sticky; top:0; z-index:50;
      background:rgba(246,250,249,0.92);
      backdrop-filter: blur(10px);
      border-bottom:1px solid rgba(230,238,235,0.85);
    }
    .headerInner{
      max-width:1200px;
      margin:0 auto;
      position:relative;
      padding:10px 12px 14px;
      min-height:170px;
    }

    .restartBtn{
      position:absolute;
      right:8px;
      top:8px;
      border:1px solid rgba(31,111,104,0.35);
      background:#fff;
      color:var(--accent2);
      border-radius:999px;
      padding:10px 12px;
      font-weight:950;
      cursor:pointer;
      box-shadow: 0 10px 18px rgba(16,24,40,.05);
      transition:.12s ease;
    }
    .restartBtn:hover{border-color: rgba(31,111,104,0.55); background: rgba(31,111,104,0.05);}

    /* Mini object icons (top-left) */
    .miniTypes{
      position:absolute;
      top:8px;
      left:8px;
      display:flex;
      gap:10px;
      align-items:center;
      opacity:0;
      pointer-events:none;
      transform: translateY(-4px);
      transition: .25s ease;
    }
    .miniTypes.show{opacity:1; pointer-events:auto; transform:none;}
    .miniBtn{
      width:46px; height:46px;
      border-radius:14px;
      border:1px solid var(--line);
      background:#fff;
      display:grid; place-items:center;
      cursor:pointer;
      box-shadow: 0 10px 18px rgba(16,24,40,.05);
      transition:.15s ease;
      overflow:hidden;
      color:var(--accent2);
    }
    .miniBtn.active{background:var(--soft); border-color: rgba(31,111,104,0.55);}

    /* Steps (connected) */
    .stepsWrap{display:flex; justify-content:center; padding-top:6px;}
    .steps{display:flex; align-items:center; gap:0;}
    .stepItem{
      display:flex;
      flex-direction:column;
      align-items:center;
      gap:8px;
      width:110px;
      cursor:pointer;
      user-select:none;
    }
    .stepCircle{
      width:50px; height:50px;
      border-radius:999px;
      border:2px solid rgba(31,111,104,0.25);
      background:#fff;
      display:grid; place-items:center;
      box-shadow: 0 8px 14px rgba(16,24,40,.05);
      transition:.15s ease;
      overflow:hidden;
      color:var(--accent2);
    }
    .stepItem.active .stepCircle{background:var(--soft); border-color: rgba(31,111,104,0.55);}
    .stepItem.done .stepCircle{background:rgba(31,111,104,0.10); border-color: rgba(31,111,104,0.55);}
    .stepLabel{font-weight:950; color:var(--muted); letter-spacing:-0.01em; font-size:13px;}
    .stepItem.active .stepLabel{color:var(--accent2)}
    .connector{
      height:2px;
      width:58px;
      background: rgba(31,111,104,0.18);
      border-radius:999px;
      transform: translateY(-16px);
      margin:0 6px;
    }

    /* Price center */
    .priceRow{margin-top:10px; display:flex; justify-content:center; text-align:center;}
    .priceBox{display:flex; flex-direction:column; align-items:center; gap:6px;}
    .priceLine{display:flex; align-items:baseline; gap:10px;}
    .price{font-size:54px; font-weight:950; letter-spacing:-0.03em; line-height:1;}
    .fixTag{font-weight:950; color:var(--accent2); font-size:14px;}
    .savedLine{font-size:13px; color:var(--muted); font-weight:950;}
    .savedLine u{ text-underline-offset:3px; }
    .fineprint{font-size:12px; color:var(--muted); line-height:1.35; max-width:680px; font-weight:900;}

    /* Headings */
    h2{margin:0 0 10px; font-size:16px; letter-spacing:-0.01em; font-weight:950; color:var(--muted);}
    .sub{margin:0 0 14px; font-size:13px; color:var(--muted); line-height:1.45; font-weight:900;}

    /* Type chooser */
    .choiceGrid{display:grid; grid-template-columns:1fr 1fr; gap:18px;}
    @media (max-width: 820px){ .choiceGrid{grid-template-columns:1fr;} }
    .choiceCard{
      background:#fff;
      border:1px solid var(--line);
      border-radius:22px;
      box-shadow: 0 12px 24px rgba(16,24,40,.06);
      padding:22px;
      cursor:pointer;
      transition: transform .15s ease, border-color .15s ease, background .15s ease, opacity .25s ease;
      display:flex;
      align-items:center;
      justify-content:center;
      min-height:180px;
      position:relative;
      overflow:hidden;
      color:var(--accent2);
    }
    .choiceCard:hover{transform: translateY(-2px); border-color: rgba(31,111,104,0.35);}
    .choiceCard.selected{border-color: rgba(31,111,104,0.65); background: rgba(31,111,104,0.06);}
    .choiceInner{display:flex; flex-direction:column; gap:10px; align-items:center; text-align:center;}
    .choiceIcon{width:92px; height:92px; display:grid; place-items:center;}
    .choiceTitle{font-weight:950; font-size:18px; color:var(--accent2);}
    .choiceHint{font-size:13px; color:var(--muted); font-weight:900;}
    .fadeOut{opacity:0; pointer-events:none; transform: scale(0.98);}

    /* Fly clone */
    .flyClone{
      position:fixed;
      z-index:999;
      pointer-events:none;
      border-radius:16px;
      background:#fff;
      border:1px solid rgba(230,238,235,.9);
      box-shadow: 0 18px 50px rgba(16,24,40,.18);
      display:grid;
      place-items:center;
      overflow:hidden;
      color:var(--accent2);
    }

    /* Form rows */
    .rows{
      display:flex;
      flex-direction:column;
      gap:10px;
      border:1px solid var(--line);
      border-radius:18px;
      padding:14px;
      background:#fff;
    }
    .rowLine{
      display:grid;
      grid-template-columns: 220px 1fr;
      gap:14px;
      align-items:center;
      padding:10px 8px;
      border-bottom:1px solid var(--line);
    }
    .rowLine:last-child{border-bottom:none;}
    @media (max-width: 760px){
      .rowLine{grid-template-columns:1fr; gap:8px;}
    }

    /* Chips */
    .chipRow{display:flex; flex-wrap:wrap; gap:10px;}
    .chip{
      border:1px solid var(--line);
      background:#fff;
      border-radius:14px;
      padding:10px 12px;
      font-weight:950;
      color:var(--muted);
      cursor:pointer;
      user-select:none;
      transition:.12s ease;
      min-width:64px;
      text-align:center;
    }
    .chip.on{background: var(--soft); border-color: rgba(31,111,104,0.55); color: var(--accent2);}

    /* Inputs */
    input, textarea{
      width:100%;
      padding:12px 12px;
      border:1px solid var(--line);
      border-radius:12px;
      background:#fff;
      color:var(--text);
      font-size:14px;
      outline:none;
    }
    input:focus, textarea:focus{
      border-color:rgba(31,111,104,0.65);
      box-shadow:0 0 0 4px rgba(31,111,104,0.12);
    }

    /* Slider */
    .sliderWrap{display:grid; grid-template-columns: 110px 1fr; gap:12px; align-items:center;}
    @media (max-width: 760px){ .sliderWrap{grid-template-columns:1fr; } }
    input[type="range"]{width:100%; accent-color: var(--accent);}

    /* Small toggle buttons */
    .smallToggleGrid{display:flex; flex-wrap:wrap; gap:10px;}
    .smallToggle{
      border:1px solid var(--line);
      background:#fff;
      border-radius:16px;
      padding:10px 12px;
      cursor:pointer;
      min-width:160px;
      display:flex;
      align-items:center;
      gap:10px;
      transition:.12s ease;
      position:relative;
      color:var(--accent2);
    }
    .smallToggle:hover{border-color: rgba(31,111,104,0.35);}
    .smallToggle.on{background:var(--soft2); border-color: rgba(31,111,104,0.55);}
    .smallToggle .tTitle{font-weight:950; color:var(--text); font-size:13px;}
    .smallToggle .tSub{font-weight:900; color:var(--muted); font-size:12px;}
    .ico24{width:22px;height:22px;display:block;color:var(--accent2);}

    /* Tooltips (kontrastreich) */
    .infoWrap{position:relative; display:inline-flex; align-items:center;}
    .infoDot{
      width:20px; height:20px;
      border-radius:999px;
      border:1px solid rgba(31,111,104,0.55);
      background:#fff;
      display:grid; place-items:center;
      cursor:help;
      color:var(--accent2);
    }
    .tip{
      position:absolute;
      left:0;
      top:26px;
      width:380px;
      max-width:420px;
      background:var(--accent2);
      color:#fff;
      border:1px solid rgba(255,255,255,0.10);
      border-radius:14px;
      box-shadow: 0 18px 40px rgba(16,24,40,.18);
      padding:12px 14px;
      font-size:13px;
      line-height:1.45;
      opacity:0;
      transform: translateY(-6px);
      pointer-events:none;
      transition:.12s ease;
      z-index:999;
      white-space:normal;
      overflow-wrap:anywhere;
    }
    .infoWrap:hover .tip{opacity:1; transform:none; pointer-events:auto;}
    .tip b{color:#fff}

    /* Savings tiles */
    .tileGrid{display:grid; grid-template-columns: repeat(4, 1fr); gap:16px;}
    @media (max-width: 1100px){ .tileGrid{grid-template-columns: repeat(3, 1fr);} }
    @media (max-width: 820px){ .tileGrid{grid-template-columns: repeat(2, 1fr);} }
    @media (max-width: 520px){ .tileGrid{grid-template-columns: 1fr;} }

    .tile{
      border:1px solid var(--line);
      background:#fff;
      border-radius:22px;
      box-shadow: 0 12px 24px rgba(16,24,40,.06);
      padding:16px;
      min-height:230px;
      cursor:pointer;
      transition: transform .15s ease, border-color .15s ease, background .15s ease;
      display:flex;
      flex-direction:column;
      justify-content:space-between;
      align-items:center;
      text-align:center;
      position:relative;
      overflow:visible;
      color:var(--accent2);
    }
    .tile:hover{transform: translateY(-2px); border-color: rgba(31,111,104,0.35);}
    .tile.on{border-color: rgba(31,111,104,0.65); background: var(--soft2);}
    /* Preis oben mittig */
    .tileTop{
      font-weight:950;
      color:var(--accent2);
      font-size:16px;
      width:100%;
      text-align:center;
      margin-top:2px;
    }
    .tileIcon{width:66px; height:66px; display:grid; place-items:center; color:var(--accent2);}
    .tileTitle{font-weight:950; color:var(--text); font-size:14px; line-height:1.2;}
    .tileInfo{position:absolute; top:10px; left:10px;}
    .tile .tip{width:400px; max-width:440px;}

    /* Actions */
    .actions{
      display:flex;
      justify-content:space-between;
      align-items:center;
      gap:12px;
      flex-wrap:wrap;
      margin-top:16px;
      padding-top:14px;
      border-top:1px solid var(--line);
    }
    .btn{
      appearance:none;
      border:none;
      border-radius:999px;
      padding:12px 16px;
      font-weight:950;
      cursor:pointer;
    }
    .btn.primary{background:var(--accent); color:#fff;}
    .btn.primary:hover{background:#1a625c;}
    .btn.secondary{background:transparent; border:1px solid rgba(31,111,104,0.35); color:var(--accent2);}

    .error{
      display:none;
      margin-top:12px;
      padding:10px 12px;
      border-radius:14px;
      background:#fff3f3;
      border:1px solid rgba(192,43,43,0.25);
      color:#8b1e1e;
      font-size:13px;
      line-height:1.4;
      font-weight:900;
    }
    .error.show{display:block;}

    /* Offer board */
    .offerWrap{max-width:560px; margin:0 auto;}
    .offerTopBar{display:flex; justify-content:space-between; align-items:center; gap:10px; margin:0 auto 10px;}
    .offerBoard{
      border:1px solid var(--line);
      border-radius:22px;
      background:#fff;
      box-shadow: 0 12px 24px rgba(16,24,40,.06);
      padding:16px;
      display:flex;
      flex-direction:column;
      gap:12px;
    }
    .offerPriceRow{display:flex; align-items:baseline; justify-content:space-between; gap:12px; flex-wrap:wrap;}
    .offerPrice{font-size:44px; font-weight:950; letter-spacing:-0.03em; line-height:1;}
    .offerFix{font-weight:950; color:var(--accent2); font-size:13px; white-space:nowrap;}
    .offerStarInfo{font-size:12px; color:var(--muted); font-weight:900; margin-top:2px; line-height:1.35;}
    .pillRow{display:flex; flex-wrap:wrap; gap:8px;}
    .pill{
      border:1px solid var(--line);
      border-radius:999px;
      padding:7px 10px;
      background:rgba(246,250,249,0.7);
      font-size:12px;
      color:var(--muted);
      font-weight:900;
    }
    .servicesPills{display:flex; flex-wrap:wrap; gap:8px;}
    .svcPill{
      display:inline-flex;
      align-items:center;
      gap:8px;
      border:1px solid var(--line);
      border-radius:999px;
      padding:8px 10px;
      background:#fff;
      font-size:12px;
      color:var(--text);
      font-weight:900;
      max-width:100%;
    }
    .svcPill .miniSvg{width:16px;height:16px;display:block;color:var(--accent2);}

    .offerButtons{
      display:flex;
      gap:10px;
      justify-content:flex-end;
      flex-wrap:wrap;
      margin-top:2px;
    }
    .btn.square{
      border-radius:16px;
      padding:12px 14px;
      width:auto;
      max-width:220px;
    }
    .offerText{
      font-size:12.5px;
      color:var(--muted);
      font-weight:900;
      line-height:1.45;
    }

    /* Contact section */
    .contactCard{
      margin-top:16px;
      border:1px solid var(--line);
      border-radius:22px;
      background:#fff;
      box-shadow: 0 12px 24px rgba(16,24,40,.06);
      padding:16px;
    }
    .formGrid{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap:12px;
    }
    @media (max-width: 820px){ .formGrid{grid-template-columns:1fr;} }
    .formRowFull{grid-column: 1 / -1;}

    .seg{
      display:inline-flex;
      border:1px solid var(--line);
      border-radius:14px;
      overflow:hidden;
      background:#fff;
    }
    .seg button{
      border:none;
      background:transparent;
      padding:7px 10px; /* kleiner */
      font-weight:950;
      color:var(--muted);
      cursor:pointer;
      font-size:12px;
      min-width:58px;
    }
    .seg button.on{background:var(--soft); color:var(--accent2);}

    .hint{
      display:none;
      margin-top:6px;
      padding:8px 10px;
      border-radius:12px;
      background:rgba(255, 249, 219, 0.65);
      border:1px solid rgba(160, 110, 0, 0.18);
      color:#6a4b00;
      font-size:12px;
      font-weight:900;
      line-height:1.35;
    }
    .hint.show{display:block;}

    /* Drag & drop */
    .dropZone{
      border:1.5px dashed rgba(31,111,104,0.35);
      border-radius:18px;
      padding:14px;
      background:rgba(31,111,104,0.04);
      display:flex;
      justify-content:space-between;
      align-items:center;
      gap:12px;
      flex-wrap:wrap;
    }
    .dropZone.drag{background:rgba(31,111,104,0.08); border-color: rgba(31,111,104,0.55);}
    .fileList{display:flex; flex-wrap:wrap; gap:8px; margin-top:10px;}
    .fileChip{
      position:relative;
      border:1px solid var(--line);
      border-radius:999px;
      padding:8px 34px 8px 10px;
      background:#fff;
      font-size:12px;
      color:var(--text);
      font-weight:900;
      max-width:100%;
    }
    .fileChip button{
      position:absolute;
      right:6px;
      top:50%;
      transform:translateY(-50%);
      width:22px;height:22px;
      border-radius:999px;
      border:1px solid rgba(0,0,0,0.08);
      background:#fff;
      cursor:pointer;
      font-weight:950;
      line-height:1;
    }
    .fileChip button:hover{background:#f3f6f5;}

    /* ===== Modal ===== */
    .modalOverlay{
      position:fixed;
      inset:0;
      background: rgba(15, 26, 23, 0.55);
      display:none;
      align-items:center;
      justify-content:center;
      z-index:2000;
      padding:16px;
    }
    .modalOverlay.show{display:flex;}
    .modal{
      width:min(520px, 100%);
      background:#fff;
      border:1px solid rgba(230,238,235,.9);
      border-radius:22px;
      box-shadow: 0 30px 90px rgba(16,24,40,.25);
      padding:16px;
    }
    .modalTitle{font-size:16px;font-weight:950;color:var(--text);margin:0 0 8px;}
    .modalText{font-size:13px;color:var(--muted);font-weight:900;line-height:1.45;margin:0 0 12px;}
    .modalActions{display:flex; gap:10px; justify-content:flex-end; flex-wrap:wrap;}
    .modalGrid{display:grid; grid-template-columns:1fr 1fr; gap:10px; margin-top:10px;}
    @media (max-width:520px){ .modalGrid{grid-template-columns:1fr;} }
    .modalOption{
      border:1px solid var(--line);
      border-radius:18px;
      background:#fff;
      padding:14px;
      cursor:pointer;
      text-align:left;
      font-weight:950;
      color:var(--text);
      box-shadow: 0 12px 24px rgba(16,24,40,.06);
      transition:.12s ease;
    }
    .modalOption:hover{border-color: rgba(31,111,104,0.40); transform: translateY(-1px);}
    .modalOption small{display:block; font-weight:900; color:var(--muted); margin-top:6px; line-height:1.35;}
    .modalRow{display:flex; gap:10px; align-items:center; margin-top:12px; flex-wrap:wrap;}
    .modalRow input{flex:1; min-width:220px;}
  </style>
</head>

<body>

  <!-- Modal -->
  <div class="modalOverlay" id="modalOverlay" role="dialog" aria-modal="true" aria-hidden="true">
    <div class="modal">
      <h3 class="modalTitle" id="modalTitle">Hinweis</h3>
      <p class="modalText" id="modalText"></p>

      <!-- dynamic content -->
      <div id="modalBody"></div>

      <div class="modalActions" id="modalActions"></div>
    </div>
  </div>

  <div class="sticky">
    <div class="headerInner">
      <button class="restartBtn" id="restartBtn" type="button">Neu starten</button>

      <!-- top-left mini object switch -->
      <div class="miniTypes" id="miniTypes">
        <button class="miniBtn" id="miniApt" type="button" title="Wohnung"></button>
        <button class="miniBtn" id="miniHouse" type="button" title="Haus"></button>
      </div>

      <!-- steps -->
      <div class="stepsWrap">
        <div class="steps" aria-label="Fortschritt">
          <div class="stepItem active" id="stepIcon1" role="button" tabindex="0">
            <div class="stepCircle" id="step1Circle"></div>
            <div class="stepLabel">Objekt</div>
          </div>

          <div class="connector"></div>

          <div class="stepItem" id="stepIcon2" role="button" tabindex="0">
            <div class="stepCircle" id="step2Circle"></div>
            <div class="stepLabel">Sparen</div>
          </div>

          <div class="connector"></div>

          <div class="stepItem" id="stepIcon3" role="button" tabindex="0">
            <div class="stepCircle" id="step3Circle"></div>
            <div class="stepLabel">Angebot</div>
          </div>
        </div>
      </div>

      <!-- price -->
      <div class="priceRow">
        <div class="priceBox">
          <div class="priceLine">
            <div class="price" id="price">CHF —</div>
            <div class="fixTag">Fixpreis*</div>
          </div>
          <div class="savedLine" id="saved">Du hast <u>0 CHF</u> gespart!</div>
          <div class="fineprint">
            * Unverbindliche Anfrage – der definitive Fixpreis wird nach Prüfung durch Easy Cleany bestätigt.
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="container">
    <div class="card">

      <!-- STEP 0: TYPE -->
      <section id="typeSection">
        <h2>Was möchtest du reinigen lassen?</h2>
        <p class="sub">Wähle dein Objekt – danach geht es Schritt für Schritt weiter.</p>

        <div class="choiceGrid">
          <div class="choiceCard selected" id="pickApt" role="button" tabindex="0">
            <div class="choiceInner">
              <div class="choiceIcon" id="aptIconBig"></div>
              <div class="choiceTitle">Wohnung</div>
              <div class="choiceHint">Schnell & klar berechnet</div>
            </div>
          </div>

          <div class="choiceCard" id="pickHouse" role="button" tabindex="0">
            <div class="choiceInner">
              <div class="choiceIcon" id="houseIconBig"></div>
              <div class="choiceTitle">Haus</div>
              <div class="choiceHint">Einfamilienhaus</div>
            </div>
          </div>
        </div>
      </section>

      <!-- STEP 1: OBJECT -->
      <section id="step1Section" class="hidden">
        <h2>Allgemeine Informationen</h2>
        <p class="sub">Ein paar Angaben – und dein Angebot ist bereit.</p>

        <div class="rows">

          <div class="rowLine">
            <div class="labelTitle">Zimmer</div>
            <div class="chipRow" id="roomsChips"></div>
          </div>

          <div class="rowLine">
            <div class="labelTitle">Bäder / Nasszellen</div>
            <div class="chipRow" id="bathsChips"></div>
          </div>

          <div class="rowLine">
            <div class="labelTitle">Fläche (m²)</div>
            <div class="sliderWrap">
              <input id="sizeInput" type="number" min="20" max="250" step="10" />
              <div>
                <input id="sizeRange" type="range" min="20" max="250" step="10" value="90" />
              </div>
            </div>
          </div>

          <div class="rowLine hidden" id="floorsRow">
            <div class="labelTitle">Etagen</div>
            <div class="chipRow" id="floorsChips"></div>
          </div>

          <div class="rowLine">
            <div class="labelTitle">Fenster</div>
            <div class="smallToggleGrid" id="windowsToggle"></div>
          </div>

          <div class="rowLine">
            <div class="labelTitle">Storen</div>
            <div class="smallToggleGrid" id="shuttersToggle"></div>
          </div>

          <div class="rowLine">
            <div style="display:flex;flex-direction:column;gap:6px;align-items:flex-start;">
              <div class="labelTitle">Verschmutzung</div>
              <div class="infoWrap">
                <span class="infoDot" id="infoDotDirt"></span>
                <span class="tip">
                  <b>Normal</b> = aufgeräumt & sauber<br>
                  <b>Stark</b> = unaufgeräumt & dreckig<br><br>
                  <div style="display:grid;grid-template-columns:1fr 1fr;gap:10px;">
                    <div style="border:1px solid rgba(255,255,255,0.18);border-radius:12px;padding:10px;">
                      <div style="font-weight:950;margin-bottom:8px;">✓ Normal</div>
                      <div style="display:flex;gap:10px;align-items:center;">
                        <img id="cleanImg" alt="clean" style="width:78px;height:52px;border-radius:10px;border:1px solid rgba(255,255,255,0.18);object-fit:cover;background:#fff;">
                        <div style="font-size:12.5px;font-weight:900;line-height:1.35;">Beispielbild – sauber</div>
                      </div>
                    </div>
                    <div style="border:1px solid rgba(255,255,255,0.18);border-radius:12px;padding:10px;">
                      <div style="font-weight:950;margin-bottom:8px;">✗ Stark</div>
                      <div style="display:flex;gap:10px;align-items:center;">
                        <img id="messyImg" alt="messy" style="width:78px;height:52px;border-radius:10px;border:1px solid rgba(255,255,255,0.18);object-fit:cover;background:#fff;">
                        <div style="font-size:12.5px;font-weight:900;line-height:1.35;">Beispielbild – stark</div>
                      </div>
                    </div>
                  </div>
                </span>
              </div>
            </div>
            <div class="smallToggleGrid" id="dirtToggle"></div>
          </div>

        </div>

        <div class="error" id="err1">Bitte fülle Zimmer, Bäder, Fläche (und beim Haus: Etagen) aus.</div>

        <div class="actions">
          <button class="btn secondary" type="button" id="backToType">Zurück</button>
          <button class="btn primary" type="button" id="toStep2">Weiter</button>
        </div>
      </section>

      <!-- STEP 2: SAVINGS -->
      <section id="step2Section" class="hidden">
        <h2>Dein Sparpotenzial</h2>
        <p class="sub"><b>Spare bis zu 500 CHF</b> – Rabatte sind standardmässig aktiv. Deaktiviere, was nicht zutrifft.</p>

        <div class="tileGrid" id="savingsGrid"></div>

        <div style="margin-top:18px;">
          <h2>Premium Services</h2>
          <p class="sub">Optional zubuchbar.</p>
          <div class="tileGrid" id="premiumGrid"></div>
        </div>

        <div class="actions">
          <button class="btn secondary" type="button" id="backTo1">Zurück</button>
          <button class="btn primary" type="button" id="toOffer">Angebot berechnen</button>
        </div>
      </section>

      <!-- STEP 3: OFFER -->
      <section id="step3Section" class="hidden">
        <div class="offerWrap">
          <div class="offerTopBar">
            <button class="btn secondary" type="button" id="backTo2">Zurück</button>
            <div></div>
          </div>

          <div class="offerBoard" id="offerBoard">
            <div>
              <div class="offerPriceRow">
                <div class="offerPrice" id="offerPrice">CHF —</div>
                <div class="offerFix">Fixpreis*</div>
              </div>
              <div class="offerStarInfo">
                * Unverbindliche Anfrage – der definitive Fixpreis wird nach Prüfung durch Easy Cleany bestätigt.
              </div>
            </div>

            <div class="pillRow">
              <div class="pill" id="offerSaved">Ersparnis: 0 CHF</div>
              <div class="pill" id="offerType">Objekt: —</div>
              <div class="pill" id="offerRooms">Zimmer: —</div>
              <div class="pill" id="offerBaths">Bäder: —</div>
              <div class="pill" id="offerSize">m²: —</div>
            </div>

            <!-- Text: über den Buttons -->
            <div class="offerText" style="margin-top:6px;">
              Deine Anfrage wurde berechnet. Vielen Dank für diese Angaben. Sichere dir dein unschlagbares Angebot so rasch als möglich!
            </div>

            <div class="offerText" style="margin-top:2px;">Folgende Leistungen sind inklusive:</div>
            <div class="servicesPills" id="servicesPills"></div>

            <div class="offerButtons">
              <button class="btn secondary square" type="button" id="saveOfferBtn">Anfrage speichern</button>
              <button class="btn primary square" type="button" id="directAskBtn">Direkt anfragen</button>
            </div>

            <div class="offerText" style="margin-top:8px;">
              Du kannst deine Anfrage jetzt sichern oder direkt bei uns anfragen. Wir melden uns so rasch als möglich wieder bei dir zurück.
            </div>
          </div>

          <!-- CONTACT (same page, below offer board) -->
          <div class="contactCard hidden" id="contactCard">
            <h2>Dein Angebot anfragen</h2>
            <p class="sub">Fülle die Felder aus und sende deine Anfrage ab.</p>

            <form id="contactForm" novalidate>
              <div class="formGrid">
                <div>
                  <label class="labelTitle">Vorname *</label>
                  <input id="firstName" required />
                </div>
                <div>
                  <label class="labelTitle">Nachname *</label>
                  <input id="lastName" required />
                </div>

                <div>
                  <label class="labelTitle">Email</label>
                  <input id="email" type="email" placeholder="name@anbieter.ch" />
                  <div class="hint" id="emailHint">Meintest du z.B. <b>gmail.com</b>, <b>outlook.com</b>, <b>hotmail.com</b>, <b>gmx.ch</b>?</div>
                </div>

                <div>
                  <label class="labelTitle">Telefon *</label>
                  <input id="phone" required placeholder="+41 ..." />
                </div>

                <div class="formRowFull">
                  <label class="labelTitle">Adresse *</label>
                  <input id="address" required placeholder="Strasse Hausnr, PLZ Ort" />
                </div>

                <div>
                  <label class="labelTitle">Wunschtermin *</label>
                  <input id="desiredDate" type="date" required />
                </div>

                <div>
                  <label class="labelTitle" style="display:flex;justify-content:space-between;align-items:center;">
                    <span>Datum flexibel</span>
                    <span class="seg" style="transform:translateY(1px);">
                      <button type="button" id="flexYes" class="on">Ja</button>
                      <button type="button" id="flexNo">Nein</button>
                    </span>
                  </label>
                </div>

                <div class="formRowFull">
                  <label class="labelTitle">Übergabetermin</label>
                  <div style="display:flex;gap:10px;align-items:center;flex-wrap:wrap;margin-top:6px;">
                    <div class="seg">
                      <button type="button" id="handoverKnown" class="on">Datum bekannt</button>
                      <button type="button" id="handoverUnknown">Nicht bekannt</button>
                    </div>
                    <input id="handoverDate" type="date" style="max-width:220px;" />
                  </div>
                </div>

                <div class="formRowFull">
                  <label class="labelTitle">Bemerkungen</label>
                  <textarea id="notes" rows="4" placeholder="Schreibe hier spezielle Informationen für deine Reinigung (z.B. Verschmutzung, heikle Stellen, Zugang, Schlüssel, etc.)."></textarea>
                </div>

                <div class="formRowFull">
                  <label class="labelTitle">Fotos des Objekts (freiwillig)</label>
                  <div class="dropZone" id="dropZone">
                    <div style="font-size:12px;color:var(--muted);font-weight:900;">
                      Drag & Drop Fotos hier hinein – oder Datei auswählen.
                    </div>
                    <button class="btn secondary" type="button" id="filePickBtn">Datei auswählen</button>
                    <input id="fileInput" type="file" accept="image/*" multiple class="hidden" />
                  </div>
                  <div class="fileList" id="fileList"></div>
                </div>
              </div>

              <div class="error" id="errContact">Bitte prüfe die Pflichtfelder (Name, Telefon, Adresse, Wunschtermin).</div>

              <div class="actions" style="justify-content:flex-end;">
                <button class="btn primary" type="submit">Angebot abschicken</button>
              </div>

              <div style="margin-top:10px;font-size:12px;color:var(--muted);font-weight:900;line-height:1.35;">
                Hinweis: Der Versand per E-Mail benötigt ein Backend (oder mailto-Fallback). Im Code ist beides vorbereitet.
              </div>
            </form>
          </div>

        </div>
      </section>

    </div>
  </div>

  <script>
    /* =========================================================
       BENÖTIGTE DATEIEN neben dieser HTML:
       - clean.jpg  (Beispielbild sauber)
       - messy.png  (Beispielbild stark verschmutzt)
       ========================================================= */
    const IMG_CLEAN = "clean.jpg";
    const IMG_MESSY = "messy.png";

    /* =========================
       Inline-Icons (stil ähnlich: dünne Linien, runde Caps)
       ========================= */
    function icon(name, size=24, cls=""){
      const common = `width="${size}" height="${size}" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="${cls}"`;
      const wrap = (paths)=>`<svg ${common}>${paths}</svg>`;

      switch(name){
        case "info":
          return wrap(`
            <circle cx="12" cy="12" r="9"></circle>
            <path d="M12 10v6"></path>
            <path d="M12 7h.01"></path>
          `);

        case "apartment":
          return wrap(`
            <path d="M5 20V6a2 2 0 0 1 2-2h8a2 2 0 0 1 2 2v14"></path>
            <path d="M3 20h18"></path>
            <path d="M8 8h.01M11 8h.01M14 8h.01"></path>
            <path d="M8 11h.01M11 11h.01M14 11h.01"></path>
            <path d="M8 14h.01M11 14h.01M14 14h.01"></path>
            <path d="M10 20v-3a2 2 0 0 1 4 0v3"></path>
          `);

        case "house":
          return wrap(`
            <path d="M3 11l9-7 9 7"></path>
            <path d="M5 10v10h14V10"></path>
            <path d="M15 20v-6a2 2 0 0 0-2-2h-2a2 2 0 0 0-2 2v6"></path>
            <path d="M18 6v3"></path>
            <path d="M19.5 6h-3"></path>
            <path d="M6.5 20c0-2 1.2-3.5 3-4 1.8.5 3 2 3 4"></path>
            <path d="M6.5 20h6"></path>
            <path d="M19 20v-5h-3v5"></path>
          `);

        case "stepHome":
          return wrap(`
            <path d="M4 11l8-7 8 7"></path>
            <path d="M6 10v10h12V10"></path>
            <path d="M10 20v-6h4v6"></path>
          `);

        case "moneybox":
          return wrap(`
            <path d="M7 10c-1 0-2 .8-2 2v4c0 2 1.2 4 7 4s7-2 7-4v-4c0-1.2-1-2-2-2"></path>
            <path d="M7 10c0-2 2-4 5-4s5 2 5 4"></path>
            <path d="M9 10h6"></path>
            <path d="M10 6l-1-2"></path>
            <path d="M14 6l1-2"></path>
            <path d="M10 14h.01M14 14h.01"></path>
            <path d="M11 17c.7.5 1.3.5 2 0"></path>
          `);

        case "doc":
          return wrap(`
            <path d="M8 3h7l3 3v15a2 2 0 0 1-2 2H8a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2z"></path>
            <path d="M15 3v4h4"></path>
            <path d="M9 11h8"></path>
            <path d="M9 15h8"></path>
            <path d="M9 19h5"></path>
          `);

        case "window":
          return wrap(`
            <rect x="6" y="5" width="12" height="14" rx="2"></rect>
            <path d="M12 5v14"></path>
            <path d="M6 12h12"></path>
          `);

        case "windows":
          return wrap(`
            <rect x="4" y="6" width="8" height="14" rx="2"></rect>
            <rect x="12" y="4" width="8" height="16" rx="2"></rect>
            <path d="M8 6v14"></path>
            <path d="M16 4v16"></path>
            <path d="M4 13h8"></path>
            <path d="M12 12h8"></path>
          `);

        case "x":
          return wrap(`<path d="M6 6l12 12"></path><path d="M18 6L6 18"></path>`);

        case "lamellas":
          return wrap(`
            <rect x="6" y="5" width="12" height="14" rx="2"></rect>
            <path d="M7 8h10"></path>
            <path d="M7 11h10"></path>
            <path d="M7 14h10"></path>
            <path d="M7 17h10"></path>
          `);

        case "roller":
          return wrap(`
            <rect x="6" y="7" width="12" height="12" rx="2"></rect>
            <path d="M6 7h12"></path>
            <path d="M8 10h8"></path>
            <path d="M8 13h8"></path>
            <path d="M8 16h8"></path>
          `);

        case "clean":
          return wrap(`
            <path d="M6 14l3 3 9-10"></path>
            <path d="M6 6h12"></path>
            <path d="M7 6l-1 3"></path>
            <path d="M17 6l1 3"></path>
          `);

        case "dirty":
          return wrap(`
            <path d="M7 8h10"></path>
            <path d="M9 12h6"></path>
            <path d="M8 16h8"></path>
            <path d="M6 19c2-1 3-1 6 0s4 1 6 0"></path>
          `);

        case "oven":
          return wrap(`<rect x="6" y="4" width="12" height="16" rx="2"></rect><path d="M9 8h6"></path><path d="M9 12h6"></path><path d="M9 16h6"></path>`);

        /* Balkon: 2 Gartenstühle */
        case "balcony":
          return wrap(`
            <path d="M6 20h12"></path>
            <path d="M7 20v-3"></path>
            <path d="M17 20v-3"></path>
            <path d="M7 10h4v7H7z"></path>
            <path d="M13 10h4v7h-4z"></path>
            <path d="M7 10l2-3h0"></path>
            <path d="M13 10l2-3h0"></path>
            <path d="M6 14h12"></path>
          `);

        case "box":
          return wrap(`<path d="M21 8l-9-5-9 5 9 5 9-5z"></path><path d="M3 8v8l9 5 9-5V8"></path><path d="M12 13v8"></path>`);

        case "parking":
          return wrap(`<path d="M7 4h7a4 4 0 0 1 0 8H7z"></path><path d="M7 12v8"></path>`);

        case "shield":
          return wrap(`<path d="M12 2l8 4v6c0 5-3.5 9.5-8 10-4.5-.5-8-5-8-10V6l8-4z"></path>`);

        /* Auto-Umriss (besser für "Ohne Garage") */
        case "carOutline":
          return wrap(`
            <path d="M5 16l1-4c.3-1 1.2-2 2.6-2h6.8c1.4 0 2.3 1 2.6 2l1 4"></path>
            <path d="M6.5 10l1.6-3h7.8l1.6 3"></path>
            <circle cx="8" cy="17" r="1.5"></circle>
            <circle cx="16" cy="17" r="1.5"></circle>
            <path d="M5 16v2"></path>
            <path d="M19 16v2"></path>
          `);

        case "tree":
          return wrap(`<path d="M12 3c3 2 5 5 5 8a5 5 0 0 1-10 0c0-3 2-6 5-8z"></path><path d="M12 14v7"></path>`);

        case "key":
          return wrap(`<circle cx="8" cy="15" r="3"></circle><path d="M11 15h10"></path><path d="M18 15v3"></path><path d="M20 15v2"></path>`);

        case "handshake":
          return wrap(`
            <path d="M8 12l2 2"></path>
            <path d="M16 12l-2 2"></path>
            <path d="M3 12l5-5c1-1 3-1 4 0l1 1"></path>
            <path d="M21 12l-5-5c-1-1-3-1-4 0l-1 1"></path>
            <path d="M8 12l3 3c1 1 2 1 3 0l2-2"></path>
            <path d="M7 13l-2 2"></path>
            <path d="M17 13l2 2"></path>
          `);

        default:
          return wrap(`<path d="M12 5v14"></path><path d="M5 12h14"></path>`);
      }
    }

    function setHTML(el, html){ el.innerHTML = html; }

    /* =========================
       PREISE
       ========================= */
    const PRICES = {
      wohnung: { "1":425, "1.5":445, "2":525, "2.5":545, "3":635, "3.5":655, "4":735, "4.5":755, "5":935, "5.5":955, "6+":1135 },
      haus:    { "4":735, "4.5":755, "5":935, "5.5":955, "6+":1135 }
    };

    const EXTRA_BATH_PRICE = 20;
    const WINDOW_DISCOUNT = { normal: 20, many: 0 };
    const DIRT_DISCOUNT   = { normal: 20, heavy: 0 };
    const SHUTTERS_DISCOUNT = { none: 20, lamellas: 0, roller: 10 };

    function houseSizeDiscount(m2){
      if(!Number.isFinite(m2)) return 0;
      if(m2 < 100) return 120;
      if(m2 >= 100 && m2 <= 200) return 60;
      return 0;
    }

    /* Spar-Kacheln (Rabatte) */
    const SAVINGS = [
      { id:"noOven",      label:"Ohne Backofen",                        amount:50,  icon:"oven",      info:"Dein Backofen ist bereits blitz blank." },
      { id:"noBalcony",   label:"Ohne Balkon/Terrasse",                 amount:20,  icon:"balcony",   info:"Du hast keinen Balkon und keine Terrasse." },
      { id:"noCellar",    label:"Ohne Keller / Dachboden",              amount:20,  icon:"box",       info:"Du hast keinen Keller/Dachboden oder er ist bereits sauber." },
      { id:"freeParking", label:"Gratis Parkieren vor Ort (Parkplatz)", amount:10,  icon:"parking",   info:"Wir dürfen vor Ort kostenlos parkieren." },
      { id:"noGuarantee", label:"Ohne Abgabegarantie",                  amount:50,  icon:"shield",    info:"Du benötigst keine Abgabegarantie." },
      { id:"noGarage",    label:"Ohne Garage",                          amount:20,  icon:"carOutline",info:"Du hast keine Garage oder Stellfläche, die gereinigt werden soll." },
      { id:"noGarden",    label:"Ohne Garten",                          amount:50,  icon:"tree",      info:"(Haus) Du hast keinen Garten.", houseOnly:true }
    ];

    /* Premium (Extras) */
    const PREMIUM = [
      { id:"premiumKey",      label:"Premium Schlüsselservice", amount:50, icon:"key",       info:"Wir holen deinen Schlüssel bei dir ab (Umkreis 30km) und bringen ihn nach der Reinigung wieder zurück." },
      { id:"premiumHandover", label:"Premium Übergabeservice",  amount:50, icon:"handshake", info:"Wir übernehmen die Übergabe vollständig für dich (mit Vollmacht)." }
    ];

    const PREMIUM_TOTAL = PREMIUM.reduce((s,p)=>s+p.amount,0);

    /* =========================
       DOM
       ========================= */
    const modalOverlay = document.getElementById("modalOverlay");
    const modalTitle = document.getElementById("modalTitle");
    const modalText = document.getElementById("modalText");
    const modalBody = document.getElementById("modalBody");
    const modalActions = document.getElementById("modalActions");

    const restartBtn = document.getElementById("restartBtn");
    const miniTypes = document.getElementById("miniTypes");
    const miniApt = document.getElementById("miniApt");
    const miniHouse = document.getElementById("miniHouse");

    const stepIcon1 = document.getElementById("stepIcon1");
    const stepIcon2 = document.getElementById("stepIcon2");
    const stepIcon3 = document.getElementById("stepIcon3");
    const step1Circle = document.getElementById("step1Circle");
    const step2Circle = document.getElementById("step2Circle");
    const step3Circle = document.getElementById("step3Circle");

    const priceEl = document.getElementById("price");
    const savedEl = document.getElementById("saved");

    const typeSection = document.getElementById("typeSection");
    const pickApt = document.getElementById("pickApt");
    const pickHouse = document.getElementById("pickHouse");

    const step1Section = document.getElementById("step1Section");
    const step2Section = document.getElementById("step2Section");
    const step3Section = document.getElementById("step3Section");

    const roomsChips = document.getElementById("roomsChips");
    const bathsChips = document.getElementById("bathsChips");
    const floorsRow = document.getElementById("floorsRow");
    const floorsChips = document.getElementById("floorsChips");

    const sizeInput = document.getElementById("sizeInput");
    const sizeRange = document.getElementById("sizeRange");

    const windowsToggle = document.getElementById("windowsToggle");
    const shuttersToggle = document.getElementById("shuttersToggle");
    const dirtToggle = document.getElementById("dirtToggle");

    const cleanImg = document.getElementById("cleanImg");
    const messyImg = document.getElementById("messyImg");
    const infoDotDirt = document.getElementById("infoDotDirt");

    const err1 = document.getElementById("err1");
    const backToType = document.getElementById("backToType");
    const toStep2 = document.getElementById("toStep2");
    const backTo1 = document.getElementById("backTo1");
    const toOffer = document.getElementById("toOffer");
    const backTo2 = document.getElementById("backTo2");

    const savingsGrid = document.getElementById("savingsGrid");
    const premiumGrid = document.getElementById("premiumGrid");

    const offerPriceEl = document.getElementById("offerPrice");
    const offerSavedEl = document.getElementById("offerSaved");
    const offerTypeEl = document.getElementById("offerType");
    const offerRoomsEl = document.getElementById("offerRooms");
    const offerBathsEl = document.getElementById("offerBaths");
    const offerSizeEl = document.getElementById("offerSize");
    const servicesPills = document.getElementById("servicesPills");

    const saveOfferBtn = document.getElementById("saveOfferBtn");
    const directAskBtn = document.getElementById("directAskBtn");
    const contactCard = document.getElementById("contactCard");

    /* Contact form */
    const contactForm = document.getElementById("contactForm");
    const errContact = document.getElementById("errContact");
    const firstName = document.getElementById("firstName");
    const lastName = document.getElementById("lastName");
    const email = document.getElementById("email");
    const emailHint = document.getElementById("emailHint");
    const phone = document.getElementById("phone");
    const address = document.getElementById("address");
    const desiredDate = document.getElementById("desiredDate");
    const flexYes = document.getElementById("flexYes");
    const flexNo = document.getElementById("flexNo");
    const handoverKnown = document.getElementById("handoverKnown");
    const handoverUnknown = document.getElementById("handoverUnknown");
    const handoverDate = document.getElementById("handoverDate");
    const notes = document.getElementById("notes");

    const dropZone = document.getElementById("dropZone");
    const filePickBtn = document.getElementById("filePickBtn");
    const fileInput = document.getElementById("fileInput");
    const fileList = document.getElementById("fileList");

    /* Big icons containers */
    const aptIconBig = document.getElementById("aptIconBig");
    const houseIconBig = document.getElementById("houseIconBig");

    /* =========================
       STATE
       ========================= */
    function defaultState(){
      return {
        currentStep: 0,
        type: "wohnung",
        typeChosen: false,

        rooms: "2",
        baths: 1,
        floors: "1",
        size: 90,

        windows: "normal",
        shutters: "none",
        dirt: "normal",

        flexible: true,
        handoverIsKnown: true,

        savings: Object.fromEntries(SAVINGS.map(s => [s.id, true])),
        premium: Object.fromEntries(PREMIUM.map(p => [p.id, false])),

        baseline: 0,
        currentPrice: 0,
        saved: 0
      };
    }
    let state = defaultState();

    /* =========================
       Modal helpers
       ========================= */
    function closeModal(){
      modalOverlay.classList.remove("show");
      modalOverlay.setAttribute("aria-hidden", "true");
      modalBody.innerHTML = "";
      modalActions.innerHTML = "";
    }
    function openModal({title, text, bodyHTML="", actions=[]}){
      modalTitle.textContent = title || "Hinweis";
      modalText.textContent = text || "";
      modalBody.innerHTML = bodyHTML || "";
      modalActions.innerHTML = "";
      actions.forEach(a=>{
        const b = document.createElement("button");
        b.type="button";
        b.className = "btn " + (a.variant || "secondary");
        b.textContent = a.label;
        b.addEventListener("click", ()=>{
          if(a.onClick) a.onClick();
        });
        modalActions.appendChild(b);
      });
      modalOverlay.classList.add("show");
      modalOverlay.setAttribute("aria-hidden", "false");
    }
    modalOverlay.addEventListener("click", (e)=>{ if(e.target === modalOverlay) closeModal(); });
    document.addEventListener("keydown", (e)=>{ if(e.key === "Escape") closeModal(); });

    /* =========================
       Helpers
       ========================= */
    function formatCHF(n){
      const v = Math.max(0, Math.round(n || 0));
      return `CHF ${v}.–`;
    }
    function formatMinus(n){
      const v = Math.max(0, Math.round(n || 0));
      return `-${v} CHF`;
    }
    function scrollToEl(el){
      const y = el.getBoundingClientRect().top + window.scrollY - 120;
      window.scrollTo({ top:y, behavior:"smooth" });
    }
    function clamp(n,min,max){ return Math.min(max, Math.max(min, n)); }
    function snap10(n){ return Math.round(n/10)*10; }

    function basePrice(){
      const table = PRICES[state.type];
      return table[state.rooms] ?? 0;
    }

    function roomsOptions(){
      return state.type === "wohnung"
        ? ["1","1.5","2","2.5","3","3.5","4","4.5","5","5.5","6+"]
        : ["4","4.5","5","5.5","6+"];
    }

    /* =========================
       Mount icons / images
       ========================= */
    function mountStaticIcons(){
      setHTML(step1Circle, icon("stepHome", 24));
      setHTML(step2Circle, icon("moneybox", 26));
      setHTML(step3Circle, icon("doc", 24));

      setHTML(aptIconBig, icon("apartment", 84));
      setHTML(houseIconBig, icon("house", 84));

      setHTML(miniApt, icon("apartment", 22));
      setHTML(miniHouse, icon("house", 22));

      setHTML(infoDotDirt, icon("info", 14));

      cleanImg.src = IMG_CLEAN;
      messyImg.src = IMG_MESSY;
    }

    /* =========================
       Step Handling
       ========================= */
    function setStep(step){
      state.currentStep = step;

      [stepIcon1, stepIcon2, stepIcon3].forEach(el => el.classList.remove("active","done"));
      if(step === 1){
        stepIcon1.classList.add("active");
      }else if(step === 2){
        stepIcon1.classList.add("done");
        stepIcon2.classList.add("active");
      }else if(step === 3){
        stepIcon1.classList.add("done");
        stepIcon2.classList.add("done");
        stepIcon3.classList.add("active");
      }else{
        stepIcon1.classList.add("active");
      }

      typeSection.classList.toggle("hidden", state.typeChosen);
      step1Section.classList.toggle("hidden", !(state.typeChosen && step === 1));
      step2Section.classList.toggle("hidden", step !== 2);
      step3Section.classList.toggle("hidden", step !== 3);
    }

    function step1Valid(showError=true){
      const hasRooms = !!state.rooms && basePrice() > 0;
      const hasBaths = Number.isFinite(state.baths) && state.baths >= 1;
      const m2 = Number(state.size);
      const hasSize = Number.isFinite(m2) && m2 > 0;
      const hasFloors = (state.type !== "haus") || (!!state.floors);
      const ok = hasRooms && hasBaths && hasSize && hasFloors;
      if(showError) err1.classList.toggle("show", !ok);
      return ok;
    }

    function applyMiniUI(){
      miniTypes.classList.add("show");
      miniApt.classList.toggle("active", state.type === "wohnung");
      miniHouse.classList.toggle("active", state.type === "haus");
    }

    /* step icon clicks */
    stepIcon1.addEventListener("click", () => {
      if(!state.typeChosen) return;
      setStep(1);
      scrollToEl(step1Section);
    });
    stepIcon2.addEventListener("click", () => {
      if(!state.typeChosen) return;
      if(!step1Valid(true)){ scrollToEl(step1Section); return; }
      setStep(2);
      renderSavingsTiles();
      renderPremiumTiles();
      scrollToEl(step2Section);
    });
    stepIcon3.addEventListener("click", () => {
      if(!state.typeChosen) return;
      if(!step1Valid(true)){ scrollToEl(step1Section); return; }
      if(state.currentStep < 3) return;
      setStep(3);
      renderOfferBoard();
      scrollToEl(step3Section);
    });

    /* =========================
       Type selection (Fly)
       ========================= */
    function flyToMini(fromCard, toMiniBtn){
      const fromIcon = fromCard.querySelector(".choiceIcon");
      if(!fromIcon) return;

      const fr = fromIcon.getBoundingClientRect();
      const tr = toMiniBtn.getBoundingClientRect();

      const clone = document.createElement("div");
      clone.className = "flyClone";
      clone.style.left = fr.left + "px";
      clone.style.top = fr.top + "px";
      clone.style.width = fr.width + "px";
      clone.style.height = fr.height + "px";
      clone.innerHTML = fromIcon.innerHTML;
      document.body.appendChild(clone);

      const dx = tr.left + (tr.width/2) - (fr.left + fr.width/2);
      const dy = tr.top + (tr.height/2) - (fr.top + fr.height/2);
      const scale = Math.min(tr.width / fr.width, tr.height / fr.height) * 0.9;

      clone.animate(
        [
          { transform:`translate(0px,0px) scale(1)`, opacity:1 },
          { transform:`translate(${dx}px,${dy}px) scale(${scale})`, opacity:1 }
        ],
        { duration: 520, easing:"cubic-bezier(.2,.9,.2,1)" }
      ).onfinish = () => clone.remove();
    }

    function setType(type){
      state.type = type;

      pickApt.classList.toggle("selected", type === "wohnung");
      pickHouse.classList.toggle("selected", type === "haus");

      floorsRow.classList.toggle("hidden", type !== "haus");
      renderFloorsChips();
      renderRoomsChips();
      applyMiniUI();

      renderWindowToggles();
      renderShutterToggles();
      renderDirtToggles();

      if(state.currentStep === 2) renderSavingsTiles();
      if(state.currentStep === 2) renderPremiumTiles();

      calcAll();
    }

    function finalizeTypeSelection(chosenCard){
      state.typeChosen = true;
      miniTypes.classList.add("show");
      const other = (chosenCard === pickApt) ? pickHouse : pickApt;
      other.classList.add("fadeOut");

      flyToMini(chosenCard, state.type === "wohnung" ? miniApt : miniHouse);

      setTimeout(() => {
        typeSection.classList.add("hidden");
        setStep(1);
        scrollToEl(step1Section);
      }, 420);
    }

    pickApt.addEventListener("click", () => { setType("wohnung"); finalizeTypeSelection(pickApt); });
    pickHouse.addEventListener("click", () => { setType("haus"); finalizeTypeSelection(pickHouse); });

    /* Klick oben links: Neustart-Hinweis + Bestätigung */
    function confirmRestartWithType(type){
      openModal({
        title: "Anfrage neu starten?",
        text: "Wenn du das Objekt wechselst, wird die Anfrage komplett neu gestartet und alle Angaben werden gelöscht.",
        actions: [
          { label:"Abbrechen", variant:"secondary", onClick: closeModal },
          { label:"Neu starten", variant:"primary", onClick: ()=>{ closeModal(); fullRestart(type); } }
        ]
      });
    }
    miniApt.addEventListener("click", ()=> { if(state.typeChosen) confirmRestartWithType("wohnung"); });
    miniHouse.addEventListener("click", ()=> { if(state.typeChosen) confirmRestartWithType("haus"); });

    /* =========================
       Chips
       ========================= */
    function renderRoomsChips(){
      const opts = roomsOptions();
      if(!opts.includes(state.rooms)) state.rooms = opts[0];
      roomsChips.innerHTML = "";
      opts.forEach(v => {
        const b = document.createElement("button");
        b.type="button";
        b.className = "chip" + (state.rooms === v ? " on" : "");
        b.textContent = v;
        b.addEventListener("click", () => { state.rooms = v; renderRoomsChips(); calcAll(); });
        roomsChips.appendChild(b);
      });
    }

    function renderBathsChips(){
      bathsChips.innerHTML = "";
      [1,2,3,4].forEach(v => {
        const b = document.createElement("button");
        b.type="button";
        b.className = "chip" + (state.baths === v ? " on" : "");
        b.textContent = (v === 4) ? "4+" : String(v);
        b.addEventListener("click", () => { state.baths = v; renderBathsChips(); calcAll(); });
        bathsChips.appendChild(b);
      });
    }

    function renderFloorsChips(){
      if(state.type !== "haus"){ floorsChips.innerHTML=""; return; }
      floorsChips.innerHTML = "";
      ["1","2","3","4+"].forEach(v => {
        const b = document.createElement("button");
        b.type="button";
        b.className = "chip" + (state.floors === v ? " on" : "");
        b.textContent = v;
        b.addEventListener("click", () => { state.floors = v; renderFloorsChips(); calcAll(); });
        floorsChips.appendChild(b);
      });
    }

    /* =========================
       Small toggles
       ========================= */
    function makeSmallToggle({title, sub, icoName}, active, onClick){
      const btn = document.createElement("button");
      btn.type="button";
      btn.className = "smallToggle" + (active ? " on" : "");
      btn.innerHTML = `
        ${icon(icoName, 22, "ico24")}
        <div style="display:flex;flex-direction:column;gap:2px;text-align:left;">
          <div class="tTitle">${title}</div>
          ${sub ? `<div class="tSub">${sub}</div>` : ``}
        </div>
      `;
      btn.addEventListener("click", onClick);
      return btn;
    }

    function renderWindowToggles(){
      windowsToggle.innerHTML = "";
      windowsToggle.appendChild(
        makeSmallToggle(
          { title:"Normal", sub:"-20 CHF", icoName:"window" },
          state.windows === "normal",
          ()=>{ state.windows="normal"; renderWindowToggles(); calcAll(); }
        )
      );
      windowsToggle.appendChild(
        makeSmallToggle(
          { title:"Eher viele / grosse", sub:"", icoName:"windows" },
          state.windows === "many",
          ()=>{ state.windows="many"; renderWindowToggles(); calcAll(); }
        )
      );
    }

    function renderShutterToggles(){
      shuttersToggle.innerHTML = "";
      shuttersToggle.appendChild(
        makeSmallToggle(
          { title:"Keine Storen", sub:"-20 CHF", icoName:"x" },
          state.shutters === "none",
          ()=>{ state.shutters="none"; renderShutterToggles(); calcAll(); }
        )
      );
      shuttersToggle.appendChild(
        makeSmallToggle(
          { title:"Lamellen", sub:"", icoName:"lamellas" },
          state.shutters === "lamellas",
          ()=>{ state.shutters="lamellas"; renderShutterToggles(); calcAll(); }
        )
      );
      shuttersToggle.appendChild(
        makeSmallToggle(
          { title:"Rolläden", sub:"-10 CHF", icoName:"roller" },
          state.shutters === "roller",
          ()=>{ state.shutters="roller"; renderShutterToggles(); calcAll(); }
        )
      );
    }

    function renderDirtToggles(){
      dirtToggle.innerHTML = "";
      dirtToggle.appendChild(
        makeSmallToggle(
          { title:"Normal", sub:"-20 CHF", icoName:"clean" },
          state.dirt === "normal",
          ()=>{ state.dirt="normal"; renderDirtToggles(); calcAll(); }
        )
      );
      dirtToggle.appendChild(
        makeSmallToggle(
          { title:"Stark verschmutzt", sub:"", icoName:"dirty" },
          state.dirt === "heavy",
          ()=>{ state.dirt="heavy"; renderDirtToggles(); calcAll(); }
        )
      );
    }

    /* =========================
       Savings tiles / Premium tiles
       ========================= */
    function infoDotHTML(text){
      return `
        <div class="tileInfo infoWrap">
          <span class="infoDot">${icon("info", 14)}</span>
          <span class="tip">${text}</span>
        </div>
      `;
    }

    function renderSavingsTiles(){
      savingsGrid.innerHTML = "";
      const isHouse = state.type === "haus";
      SAVINGS.filter(s => !s.houseOnly || isHouse).forEach(opt => {
        const tile = document.createElement("button");
        tile.type="button";
        tile.className = "tile" + (state.savings[opt.id] ? " on" : "");
        tile.innerHTML = `
          ${infoDotHTML(opt.info)}
          <div class="tileTop">${formatMinus(opt.amount)}</div>
          <div class="tileIcon">${icon(opt.icon, 64)}</div>
          <div class="tileTitle">${opt.label}</div>
        `;
        tile.addEventListener("click", () => {
          state.savings[opt.id] = !state.savings[opt.id];
          renderSavingsTiles();
          calcAll();
        });
        savingsGrid.appendChild(tile);
      });
    }

    function renderPremiumTiles(){
      premiumGrid.innerHTML = "";
      PREMIUM.forEach(opt => {
        const tile = document.createElement("button");
        tile.type="button";
        tile.className = "tile" + (state.premium[opt.id] ? " on" : "");
        tile.innerHTML = `
          ${infoDotHTML(opt.info)}
          <div class="tileTop">+${opt.amount} CHF</div>
          <div class="tileIcon">${icon(opt.icon, 64)}</div>
          <div class="tileTitle">${opt.label}</div>
        `;
        tile.addEventListener("click", () => {
          state.premium[opt.id] = !state.premium[opt.id];
          renderPremiumTiles();
          calcAll();
        });
        premiumGrid.appendChild(tile);
      });
    }

    /* =========================
       Preisberechnung
       Saved = Max (inkl. Premium) - aktueller Preis
       => zählt Premium NICHT gebucht automatisch als Ersparnis
       ========================= */
    function calcDeductionsOnly(){
      let d = 0;

      SAVINGS.forEach(opt => {
        if(opt.houseOnly && state.type !== "haus") return;
        if(state.savings[opt.id]) d += opt.amount;
      });

      d += (WINDOW_DISCOUNT[state.windows] ?? 0);
      d += (DIRT_DISCOUNT[state.dirt] ?? 0);
      d += (SHUTTERS_DISCOUNT[state.shutters] ?? 0);

      if(state.type === "haus"){
        d += houseSizeDiscount(Number(state.size));
      }
      return Math.max(0, Math.round(d));
    }

    function calcAll(){
      const base = basePrice();

      const bathsVal = (state.baths === 4) ? 4 : state.baths;
      const extraBaths = Math.max(0, bathsVal - 1) * EXTRA_BATH_PRICE;

      const baseline = base + extraBaths;                // ohne Premium
      const maxWithPremium = baseline + PREMIUM_TOTAL;   // Maximum inkl. Premium

      const deductions = calcDeductionsOnly();
      let current = baseline - deductions;

      let selectedPremiumSum = 0;
      PREMIUM.forEach(p => { if(state.premium[p.id]) selectedPremiumSum += p.amount; });
      current += selectedPremiumSum;

      const saved = Math.max(0, Math.round(maxWithPremium - current));

      state.baseline = baseline;
      state.currentPrice = current;
      state.saved = saved;

      priceEl.textContent = formatCHF(current);
      savedEl.innerHTML = `Du hast <u>${saved} CHF</u> gespart!`;

      if(state.currentStep === 3) renderOfferBoard();
    }

    /* =========================
       Offer board
       ========================= */
    function svcPill(label, miniIconName){
      const span = document.createElement("span");
      span.className = "svcPill";
      span.innerHTML = `${miniIconName ? icon(miniIconName, 16, "miniSvg") : ""}<span>${label}</span>`;
      return span;
    }

    function renderOfferBoard(){
      offerPriceEl.textContent = formatCHF(state.currentPrice);
      offerSavedEl.textContent = `Ersparnis: ${Math.round(state.saved)} CHF`;
      offerTypeEl.textContent = `Objekt: ${state.type === "wohnung" ? "Wohnung" : "Haus"}`;
      offerRoomsEl.textContent = `Zimmer: ${state.rooms}`;
      offerBathsEl.textContent = `Bäder: ${state.baths === 4 ? "4+" : state.baths}`;
      offerSizeEl.textContent = `m²: ${state.size}`;

      servicesPills.innerHTML = "";
      servicesPills.appendChild(svcPill(`Fenster: ${state.windows === "normal" ? "Normal" : "Eher viele / grosse"}`, state.windows === "normal" ? "window" : "windows"));
      servicesPills.appendChild(svcPill(`Storen: ${state.shutters === "none" ? "Keine" : (state.shutters === "lamellas" ? "Lamellen" : "Rolläden")}`, null));
      servicesPills.appendChild(svcPill(`Verschmutzung: ${state.dirt === "normal" ? "Normal" : "Stark verschmutzt"}`, state.dirt === "normal" ? "clean" : "dirty"));

      const bathsVal = (state.baths === 4) ? 4 : state.baths;
      const extra = Math.max(0, bathsVal - 1) * EXTRA_BATH_PRICE;
      if(extra > 0) servicesPills.appendChild(svcPill(`Zusätzliche Nasszellen: +${extra} CHF`, null));

      SAVINGS.forEach(opt => {
        if(opt.houseOnly && state.type !== "haus") return;
        if(state.savings[opt.id]) servicesPills.appendChild(svcPill(`${opt.label}: -${opt.amount} CHF`, opt.icon));
      });

      PREMIUM.forEach(opt => {
        if(state.premium[opt.id]) servicesPills.appendChild(svcPill(`${opt.label}: +${opt.amount} CHF`, opt.icon));
      });
    }

    /* =========================
       Save offer (custom modal)
       ========================= */
    async function exportOfferPDF(){
      const el = document.getElementById("offerBoard");
      const canvas = await html2canvas(el, { scale: 2, backgroundColor: "#ffffff" });
      const imgData = canvas.toDataURL("image/png");
      const { jsPDF } = window.jspdf;
      const pdf = new jsPDF({ orientation: "p", unit: "pt", format: "a4" });
      const pageW = pdf.internal.pageSize.getWidth();
      const margin = 36;
      const imgW = pageW - margin*2;
      const imgH = canvas.height * (imgW / canvas.width);
      pdf.addImage(imgData, "PNG", margin, margin, imgW, imgH);
      pdf.save("EasyCleany_Angebot.pdf");
    }

    function buildOfferText(){
      const lines = [];
      lines.push(`Easy Cleany – Anfrage Endreinigung`);
      lines.push(`Objekt: ${state.type === "wohnung" ? "Wohnung" : "Haus"}`);
      lines.push(`Zimmer: ${state.rooms} | Bäder: ${state.baths === 4 ? "4+" : state.baths} | Fläche: ${state.size} m²`);
      if(state.type === "haus") lines.push(`Etagen: ${state.floors}`);
      lines.push(`Fenster: ${state.windows === "normal" ? "Normal" : "Eher viele / grosse"}`);
      lines.push(`Storen: ${state.shutters === "none" ? "Keine" : (state.shutters === "lamellas" ? "Lamellen" : "Rolläden")}`);
      lines.push(`Verschmutzung: ${state.dirt === "normal" ? "Normal" : "Stark verschmutzt"}`);
      lines.push(`Fixpreis*: ${formatCHF(state.currentPrice)}`);
      lines.push(`Ersparnis: ${state.saved} CHF`);
      lines.push(``);
      lines.push(`Rabatte aktiv:`);
      SAVINGS.forEach(opt => {
        if(opt.houseOnly && state.type !== "haus") return;
        if(state.savings[opt.id]) lines.push(`- ${opt.label} (-${opt.amount} CHF)`);
      });
      lines.push(``);
      lines.push(`Premium:`);
      PREMIUM.forEach(opt => {
        lines.push(`${state.premium[opt.id] ? "+ " : "- "}${opt.label} (${opt.amount} CHF)`);
      });
      lines.push(``);
      lines.push(`* Unverbindliche Anfrage – der definitive Fixpreis wird nach Prüfung bestätigt.`);
      return lines.join("\n");
    }

    function sendOfferByEmail(to){
      const subject = encodeURIComponent("Easy Cleany – Angebot speichern");
      const body = encodeURIComponent(buildOfferText());
      window.location.href = `mailto:${encodeURIComponent(to)}?subject=${subject}&body=${body}`;
    }

    function openSaveModal(){
      openModal({
        title: "Anfrage speichern",
        text: "Wie möchtest du dein Angebot sichern?",
        bodyHTML: `
          <div class="modalGrid">
            <button class="modalOption" id="savePdfOpt" type="button">
              Als PDF speichern
              <small>Du erhältst eine PDF-Datei mit deiner Angebotstafel.</small>
            </button>
            <button class="modalOption" id="saveMailOpt" type="button">
              Per Email senden
              <small>Wir senden dir (mailto) das Angebot als Text – PDF optional später via Backend.</small>
            </button>
          </div>
          <div class="modalRow hidden" id="emailRow">
            <input id="saveMailInput" type="email" placeholder="deine@email.ch" />
            <button class="btn primary" id="sendMailBtn" type="button">Senden</button>
          </div>
        `,
        actions: [
          { label:"Schliessen", variant:"secondary", onClick: closeModal }
        ]
      });

      const pdfOpt = document.getElementById("savePdfOpt");
      const mailOpt = document.getElementById("saveMailOpt");
      const emailRow = document.getElementById("emailRow");
      const mailInput = document.getElementById("saveMailInput");
      const sendBtn = document.getElementById("sendMailBtn");

      pdfOpt.addEventListener("click", async ()=>{ closeModal(); await exportOfferPDF(); });

      mailOpt.addEventListener("click", ()=>{
        emailRow.classList.remove("hidden");
        mailInput.focus();
      });

      sendBtn.addEventListener("click", ()=>{
        const to = (mailInput.value || "").trim();
        if(!to || !to.includes("@")){
          mailInput.focus();
          mailInput.style.borderColor = "rgba(192,43,43,0.55)";
          return;
        }
        closeModal();
        sendOfferByEmail(to);
      });
    }

    /* =========================
       Buttons & navigation
       ========================= */
    backToType.addEventListener("click", () => {
      state.typeChosen = false;
      miniTypes.classList.remove("show");
      pickApt.classList.remove("fadeOut");
      pickHouse.classList.remove("fadeOut");
      typeSection.classList.remove("hidden");
      step1Section.classList.add("hidden");
      step2Section.classList.add("hidden");
      step3Section.classList.add("hidden");
      contactCard.classList.add("hidden");

      state.currentStep = 0;
      [stepIcon1,stepIcon2,stepIcon3].forEach(el => el.classList.remove("active","done"));
      stepIcon1.classList.add("active");

      window.scrollTo({ top:0, behavior:"smooth" });
      calcAll();
    });

    toStep2.addEventListener("click", () => {
      if(!step1Valid(true)) return;
      setStep(2);
      renderSavingsTiles();
      renderPremiumTiles();
      scrollToEl(step2Section);
    });

    backTo1.addEventListener("click", () => {
      setStep(1);
      scrollToEl(step1Section);
    });

    toOffer.addEventListener("click", () => {
      if(!step1Valid(true)) { setStep(1); scrollToEl(step1Section); return; }
      setStep(3);
      renderOfferBoard();
      scrollToEl(step3Section);
    });

    backTo2.addEventListener("click", () => {
      setStep(2);
      renderSavingsTiles();
      renderPremiumTiles();
      scrollToEl(step2Section);
    });

    directAskBtn.addEventListener("click", () => {
      contactCard.classList.remove("hidden");
      scrollToEl(contactCard);
    });

    saveOfferBtn.addEventListener("click", () => {
      openSaveModal(); /* kein Browser-Prompt */
    });

    function fullRestart(type="wohnung"){
      state = defaultState();
      mountStaticIcons();

      miniTypes.classList.remove("show");
      pickApt.classList.remove("fadeOut");
      pickHouse.classList.remove("fadeOut");

      state.type = type;
      setType(type);

      typeSection.classList.remove("hidden");
      step1Section.classList.add("hidden");
      step2Section.classList.add("hidden");
      step3Section.classList.add("hidden");
      contactCard.classList.add("hidden");

      state.typeChosen = false;
      state.currentStep = 0;

      [stepIcon1,stepIcon2,stepIcon3].forEach(el => el.classList.remove("active","done"));
      stepIcon1.classList.add("active");

      sizeInput.value = String(state.size);
      sizeRange.value = String(state.size);

      window.scrollTo({ top:0, behavior:"smooth" });
      calcAll();
    }

    restartBtn.addEventListener("click", () => {
      openModal({
        title:"Neu starten?",
        text:"Möchtest du die Anfrage komplett neu starten? Alle Angaben werden gelöscht.",
        actions:[
          { label:"Abbrechen", variant:"secondary", onClick: closeModal },
          { label:"Neu starten", variant:"primary", onClick: ()=>{ closeModal(); fullRestart(state.type); } }
        ]
      });
    });

    /* =========================
       Size input/range (10er Schritte, Snap)
       ========================= */
    function setSize(n){
      if(!Number.isFinite(n)) return;
      const snapped = snap10(n);
      state.size = snapped;
      sizeInput.value = String(snapped);
      const min = Number(sizeRange.min), max = Number(sizeRange.max);
      sizeRange.value = String(clamp(snapped, min, max));
      calcAll();
    }
    sizeInput.addEventListener("input", () => {
      const n = Number(sizeInput.value);
      if(!Number.isFinite(n)) return;
      setSize(n);
    });
    sizeRange.addEventListener("input", () => {
      const n = Number(sizeRange.value);
      setSize(n);
    });

    /* =========================
       Email hint
       ========================= */
    function normalizeEmailHint(val){
      const v = (val || "").toLowerCase();
      if(!v.includes("@")) return false;
      const domain = v.split("@")[1] || "";
      const commonTypos = ["gnail", "gmal", "outlok", "hotnail", "homail", "gmxcom", "gmai"];
      return commonTypos.some(t => domain.includes(t));
    }
    email.addEventListener("input", () => {
      emailHint.classList.toggle("show", normalizeEmailHint(email.value));
    });

    function setSeg(onBtn, offBtn){
      onBtn.classList.add("on");
      offBtn.classList.remove("on");
    }
    flexYes.addEventListener("click", () => { state.flexible = true; setSeg(flexYes, flexNo); });
    flexNo.addEventListener("click", () => { state.flexible = false; setSeg(flexNo, flexYes); });

    handoverKnown.addEventListener("click", () => {
      state.handoverIsKnown = true;
      setSeg(handoverKnown, handoverUnknown);
      handoverDate.classList.remove("hidden");
    });
    handoverUnknown.addEventListener("click", () => {
      state.handoverIsKnown = false;
      setSeg(handoverUnknown, handoverKnown);
      handoverDate.value = "";
      handoverDate.classList.add("hidden");
    });

    /* =========================
       Drag & drop files
       ========================= */
    let files = [];
    function renderFiles(){
      fileList.innerHTML = "";
      files.forEach((f, idx) => {
        const chip = document.createElement("div");
        chip.className = "fileChip";
        chip.textContent = f.name;
        const x = document.createElement("button");
        x.type="button";
        x.textContent = "×";
        x.title = "Datei entfernen";
        x.addEventListener("click", () => {
          files.splice(idx, 1);
          renderFiles();
        });
        chip.appendChild(x);
        fileList.appendChild(chip);
      });
    }
    function addFiles(list){
      const arr = Array.from(list || []);
      arr.forEach(f => {
        if(!f.type.startsWith("image/")) return;
        files.push(f);
      });
      renderFiles();
    }
    filePickBtn.addEventListener("click", ()=> fileInput.click());
    fileInput.addEventListener("change", (e)=> addFiles(e.target.files));

    dropZone.addEventListener("dragover", (e)=>{ e.preventDefault(); dropZone.classList.add("drag"); });
    dropZone.addEventListener("dragleave", ()=> dropZone.classList.remove("drag"));
    dropZone.addEventListener("drop", (e)=>{
      e.preventDefault();
      dropZone.classList.remove("drag");
      addFiles(e.dataTransfer.files);
    });

    /* =========================
       Contact submit
       ========================= */
    contactForm.addEventListener("submit", async (e) => {
      e.preventDefault();
      errContact.classList.remove("show");

      const ok =
        firstName.value.trim().length > 0 &&
        lastName.value.trim().length > 0 &&
        phone.value.trim().length > 0 &&
        address.value.trim().length > 0 &&
        desiredDate.value.trim().length > 0;

      if(!ok){
        errContact.classList.add("show");
        scrollToEl(contactCard);
        return;
      }

      const payload = {
        offerText: buildOfferText(),
        contact: {
          firstName: firstName.value.trim(),
          lastName: lastName.value.trim(),
          email: email.value.trim(),
          phone: phone.value.trim(),
          address: address.value.trim(),
          desiredDate: desiredDate.value.trim(),
          flexible: state.flexible,
          handoverKnown: state.handoverIsKnown,
          handoverDate: state.handoverIsKnown ? handoverDate.value.trim() : "",
          notes: notes.value.trim()
        }
      };

      try{
        const res = await fetch("/api/send-offer", {
          method:"POST",
          headers:{ "Content-Type":"application/json" },
          body: JSON.stringify(payload)
        });
        if(res.ok){
          openModal({
            title:"Gesendet ✅",
            text:"Danke! Deine Anfrage wurde gesendet. Wir melden uns so rasch wie möglich.",
            actions:[{label:"Schliessen", variant:"primary", onClick: closeModal}]
          });
          return;
        }
      }catch(_){
        // noop
      }

      const subject = encodeURIComponent("Easy Cleany – Anfrage Endreinigung");
      const body = encodeURIComponent(payload.offerText + "\n\nKontakt:\n" +
        `${payload.contact.firstName} ${payload.contact.lastName}\n` +
        `Telefon: ${payload.contact.phone}\n` +
        `Email: ${payload.contact.email || "-"}\n` +
        `Adresse: ${payload.contact.address}\n` +
        `Wunschtermin: ${payload.contact.desiredDate}\n` +
        `Datum flexibel: ${payload.contact.flexible ? "Ja" : "Nein"}\n` +
        `Übergabetermin: ${payload.contact.handoverKnown ? (payload.contact.handoverDate || "—") : "Nicht bekannt"}\n\n` +
        `Bemerkungen:\n${payload.contact.notes || "-"}`
      );
      window.location.href = `mailto:easycleany@outlook.com?subject=${subject}&body=${body}`;
    });

    /* =========================
       Init
       ========================= */
    function init(){
      mountStaticIcons();
      renderBathsChips();
      renderFloorsChips();
      renderRoomsChips();

      sizeInput.value = String(state.size);
      sizeRange.value = String(state.size);

      setType("wohnung");
      calcAll();
    }
    init();
  </script>
</body>
</html>
