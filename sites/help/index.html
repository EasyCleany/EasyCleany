<!doctype html>
<html lang="de">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Help | Easy Cleany</title>
  <style>
    :root{
      --bg:#f6f3fb;
      --card:#ffffff;
      --text:#1d1330;
      --muted:#6a5f7d;
      --line:#e9e1f3;
      --accent:#833CCF;
      --accent-dark:#5f1fa1;
      --accent-soft:rgba(131,60,207,0.12);
      --accent-soft-2:rgba(131,60,207,0.06);
      --shadow:0 16px 40px rgba(26,17,43,.12);
      --radius:18px;
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      background:var(--bg);
      font-family: ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, Arial, "Noto Sans", sans-serif;
      color:var(--text);
    }
    button{font:inherit;}
    a{color:inherit; text-decoration:none;}
    .help-app{min-height:100vh;}

    /* ----- HERO / SUCHE ----- */
    .hero{
      background:
        radial-gradient(1200px 520px at 10% 0%, rgba(255,255,255,.08), rgba(0,0,0,0)),
        radial-gradient(600px 300px at 90% 30%, rgba(255,177,80,.35), rgba(0,0,0,0)),
        linear-gradient(135deg, #5a1d99 0%, #833CCF 60%, #4a1d76 100%);
      color:#fff;
      padding:70px 20px 90px;
      position:relative;
      overflow:hidden;
    }
    .hero::before,
    .hero::after{
      content:"";
      position:absolute;
      border-radius:999px;
      opacity:.65;
    }
    .hero::before{
      width:260px; height:260px;
      background:#4fd1ff;
      bottom:-120px; left:-80px;
    }
    .hero::after{
      width:180px; height:180px;
      background:#ff9f66;
      top:-70px; right:-50px;
    }
    .hero-inner{
      max-width:1100px;
      margin:0 auto;
      text-align:center;
      position:relative;
      z-index:1;
    }
    .hero h1{
      margin:0 0 16px;
      font-size:clamp(2.2rem, 4vw, 3.6rem);
      font-weight:900;
      letter-spacing:-0.02em;
      color:#fff;
    }
    .hero p{
      margin:0 0 24px;
      font-size:1.05rem;
      color:rgba(255,255,255,.85);
    }
    .search-wrap{
      position:relative;
      max-width:680px;
      margin:0 auto;
    }
    .searchbar{
      background:#fff;
      border-radius:16px;
      display:flex;
      align-items:center;
      gap:10px;
      padding:12px 16px;
      box-shadow:var(--shadow);
      color:var(--muted);
    }
    .searchbar span{font-size:1.1rem;}
    .searchbar input{
      border:none;
      outline:none;
      flex:1;
      font-size:1rem;
      min-width: 80px;
    }
    .search-btn{
      border:none;
      background:var(--accent);
      color:#fff;
      padding:10px 18px;
      border-radius:12px;
      font-weight:700;
      cursor:pointer;
      box-shadow:0 8px 18px rgba(26,17,43,.18);
      white-space:nowrap;
    }

    /* Dropdown Suggestions */
    .search-suggestions{
      position:absolute;
      left:0; right:0;
      top:calc(100% + 10px);
      background:#fff;
      border-radius:14px;
      border:1px solid var(--line);
      box-shadow:var(--shadow);
      display:none;
      overflow:hidden;
      text-align:left;
      z-index:50;
    }
    .search-suggestions.active{display:block;}
    .search-suggestion{
      width:100%;
      padding:12px 16px;
      border-bottom:1px solid var(--line);
      cursor:pointer;
      font-weight:600;
      color:var(--muted);
      display:flex;
      flex-direction:column;
      gap:6px;
      background:#fff;
      text-align:left;
    }
    .search-suggestion:last-child{border-bottom:none;}
    .search-suggestion strong{color:var(--accent-dark);}
    .search-suggestion small{color:var(--muted); font-weight:600;}
    .search-suggestion:hover{background:rgba(131,60,207,0.04);}

    .container{
      max-width:1200px;
      margin:0 auto;
      padding:40px 20px 80px;
    }

    .view{display:none;}
    .view.active{display:block;}

    /* ----- HOME / KATEGORIEN ----- */
    .category-grid{
      display:grid;
      grid-template-columns:repeat(3, minmax(0, 1fr));
      gap:22px;
      margin-top:-60px;
    }
    @media (max-width: 980px){
      .category-grid{grid-template-columns:repeat(2, minmax(0, 1fr));}
    }
    @media (max-width: 640px){
      .category-grid{grid-template-columns:1fr;}
    }
    .category-card{
      background:var(--card);
      border-radius:20px;
      padding:28px 24px;
      box-shadow:var(--shadow);
      border:1px solid var(--line);
      display:flex;
      flex-direction:column;
      align-items:center;
      text-align:center;
      gap:14px;
      cursor:pointer;
      transition:transform .15s ease, border-color .15s ease;
    }
    .category-card:hover{transform:translateY(-3px); border-color:rgba(131,60,207,.4);}
    .category-icon{
      width:88px; height:88px;
      display:grid; place-items:center;
      border-radius:24px;
      background:var(--accent-soft);
      font-size:2.4rem;
    }
    .category-card h3{
      margin:0;
      font-size:1.2rem;
      font-weight:800;
    }
    .category-card p{
      margin:0;
      color:var(--muted);
      font-size:.95rem;
      line-height:1.4;
    }

    /* ----- KATEGORIE VIEW ----- */
    .category-layout{
      display:grid;
      grid-template-columns:220px 1fr;
      gap:26px;
      align-items:start;
    }
    @media (max-width: 900px){
      .category-layout{grid-template-columns:1fr;}
    }
    .category-tabs{
      background:#fff;
      border-radius:18px;
      border:1px solid var(--line);
      padding:12px;
      box-shadow:var(--shadow);
      position:sticky;
      top:20px;
    }
    .category-tabs h4{
      margin:6px 10px 12px;
      font-size:.9rem;
      color:var(--muted);
      font-weight:800;
      text-transform:uppercase;
      letter-spacing:.08em;
    }
    .category-tab{
      display:flex;
      align-items:center;
      gap:10px;
      padding:10px 12px;
      border-radius:14px;
      font-weight:700;
      color:var(--muted);
      cursor:pointer;
      transition:background .15s ease, color .15s ease;
    }
    .category-tab.active{
      background:var(--accent-soft);
      color:var(--accent-dark);
    }

    .category-header{
      background:#fff;
      border-radius:20px;
      border:1px solid var(--line);
      box-shadow:var(--shadow);
      padding:24px;
      margin-bottom:20px;
    }
    .category-header h2{
      margin:0 0 8px;
      font-size:1.8rem;
    }
    .category-header p{
      margin:0;
      color:var(--muted);
    }

    .subcat-grid{
      display:grid;
      grid-template-columns:1fr;
      gap:16px;
    }
    .subcat-card{
      background:#fff;
      border-radius:18px;
      border:1px solid var(--line);
      padding:18px;
      display:flex;
      flex-direction:column;
      gap:12px;
      box-shadow:var(--shadow);
      cursor:default;
      transition:transform .15s ease, border-color .15s ease;
    }
    .subcat-card:hover{border-color:var(--line);}
    .subcat-icon{
      width:48px; height:48px;
      border-radius:14px;
      display:grid; place-items:center;
      background:var(--accent-soft-2);
      font-size:1.4rem;
      color:var(--accent-dark);
    }
    .subcat-card h3{margin:0; font-size:1.1rem;}
    .subcat-card p{margin:0; color:var(--muted); font-size:.92rem;}
    .subcat-list{
      margin:0;
      padding-left:18px;
      color:var(--muted);
      font-size:.92rem;
      line-height:1.5;
      display:flex;
      flex-direction:column;
      gap:8px;
    }
    .subcat-list li{margin:0;}
    .subcat-link{
      color:var(--accent-dark);
      font-weight:600;
      text-decoration:none;
      background:none;
      border:none;
      padding:0;
      text-align:left;
      cursor:pointer;
    }
    .subcat-link:hover{text-decoration:underline;}

    /* ----- SEARCH VIEW ----- */
    .search-results-head{
      display:flex;
      justify-content:space-between;
      align-items:flex-end;
      gap:20px;
      margin-bottom:20px;
      background:linear-gradient(135deg, #5a1d99 0%, #833CCF 60%, #4a1d76 100%);
      color:#fff;
      padding:18px 20px;
      border-radius:18px;
    }
    .search-results-head h2{margin:0; color:#fff; font-size:2rem;}
    .search-results-meta{color:rgba(255,255,255,.85);}
    .search-results-grid{
      display:grid;
      gap:16px;
    }
    .search-result-card{
      background:#fff;
      border-radius:18px;
      border:1px solid var(--line);
      padding:18px;
      box-shadow:var(--shadow);
      cursor:pointer;
      transition:transform .15s ease, border-color .15s ease;
    }
    .search-result-card:hover{transform:translateY(-3px); border-color:rgba(131,60,207,.4);}
    .search-result-card h3{margin:0 0 8px; font-size:1.05rem;}
    .search-result-card p{
      margin:0;
      color:var(--muted);
      display:-webkit-box;
      -webkit-line-clamp:3;
      -webkit-box-orient:vertical;
      overflow:hidden;
    }
    .category-tag{
      display:inline-flex;
      align-items:center;
      justify-content:center;
      padding:6px 12px;
      border-radius:10px;
      font-weight:700;
      font-size:.75rem;
      color:#fff;
      width:max-content;
      margin-bottom:10px;
    }
    .category-tag[data-category="reinigung"]{background:#6f3ccf;}
    .category-tag[data-category="uebergabe"]{background:#ff8c6a;}
    .category-tag[data-category="schaeden"]{background:#2e7dd7;}
    .category-tag[data-category="kaution"]{background:#1f9d6e;}
    .category-tag[data-category="allgemeines"]{background:#8b5a2b;}

    /* ----- ARTICLE VIEW ----- */
    .article-layout{
      display:grid;
      grid-template-columns:1fr 260px;
      gap:30px;
      align-items:start;
    }
    @media (max-width: 980px){
      .article-layout{grid-template-columns:1fr;}
    }
    .article-card{
      background:#fff;
      border-radius:20px;
      border:1px solid var(--line);
      padding:26px;
      box-shadow:var(--shadow);
    }
    .breadcrumb{
      display:flex;
      flex-wrap:wrap;
      gap:8px;
      color:var(--muted);
      font-size:.9rem;
      margin-bottom:14px;
      align-items:center;
    }
    .breadcrumb span{
      display:inline-flex;
      align-items:center;
      gap:6px;
    }
    .pill{
      background:var(--accent-soft);
      color:var(--accent-dark);
      font-weight:700;
      padding:4px 10px;
      border-radius:999px;
      font-size:.8rem;
    }
    .article-card h2{
      margin:0;
      font-size:2rem;
    }
    .article-card p{
      color:var(--muted);
      line-height:1.6;
    }
    .article-section{margin-top:26px;}
    .article-section h3{
      margin:0 0 8px;
      font-size:1.2rem;
      color:var(--accent-dark);
    }
    .article-header{
      display:flex;
      align-items:flex-start;
      justify-content:space-between;
      gap:16px;
      margin-bottom:14px;
    }
    .like-counter{
      display:inline-flex;
      align-items:center;
      gap:6px;
      font-weight:700;
      color:var(--accent-dark);
      background:var(--accent-soft-2);
      padding:6px 10px;
      border-radius:999px;
      font-size:.85rem;
      white-space:nowrap;
    }
    .source-bar{
      margin:18px 0 10px;
      display:flex;
      flex-wrap:wrap;
      gap:10px;
      align-items:center;
      color:var(--muted);
      font-size:.92rem;
    }
    .source-links{
      display:flex;
      flex-wrap:wrap;
      gap:8px;
    }
    .source-pill{
      background:var(--accent-soft-2);
      color:var(--accent-dark);
      padding:6px 12px;
      border-radius:999px;
      font-weight:700;
      font-size:.82rem;
      cursor:pointer;
      display:inline-flex;
      align-items:center;
      gap:6px;
    }

    .article-nav{
      background:#fff;
      border-radius:18px;
      border:1px solid var(--line);
      padding:16px;
      box-shadow:var(--shadow);
      position:sticky;
      top:20px;
    }
    .article-nav h4{
      margin:6px 0 12px;
      font-size:.85rem;
      text-transform:uppercase;
      letter-spacing:.08em;
      color:var(--muted);
    }
    .article-nav a{
      display:block;
      padding:8px 10px;
      border-radius:12px;
      color:var(--muted);
      font-weight:600;
      font-size:.92rem;
    }
    .article-nav a:hover{background:var(--accent-soft-2); color:var(--accent-dark);}

    /* ----- FEEDBACK / REQUEST ----- */
    .feedback{
      margin-top:32px;
      border-top:1px solid var(--line);
      padding-top:22px;
    }
    .feedback h4{margin:0 0 14px;}
    .feedback-actions{
      display:flex; gap:12px; flex-wrap:wrap;
    }
    .btn{
      border:1px solid var(--accent);
      background:#fff;
      color:var(--accent-dark);
      padding:10px 16px;
      border-radius:12px;
      cursor:pointer;
      font-weight:700;
    }
    .btn-primary{background:var(--accent); color:#fff;}
    .btn-outline{background:#fff;}

    .feedback-form,
    .feedback-quick{
      margin-top:16px;
      display:grid;
      gap:12px;
    }
    .feedback-form textarea,
    .feedback-quick input{
      width:100%;
      border-radius:12px;
      border:1px solid var(--line);
      padding:12px;
      font-family:inherit;
    }
    .feedback-quick input{min-height:48px;}
    .feedback-options{
      display:grid;
      gap:10px;
      color:var(--muted);
      font-size:.95rem;
    }
    .feedback-thanks{
      margin-top:16px;
      background:var(--accent-soft);
      color:var(--accent-dark);
      padding:16px;
      border-radius:14px;
      font-weight:700;
    }

    .toolbar{
      display:flex;
      gap:12px;
      flex-wrap:wrap;
      margin-bottom:18px;
    }
    .link-btn{
      border:none;
      background:transparent;
      color:var(--accent-dark);
      font-weight:700;
      cursor:pointer;
      padding:0;
    }
    .toolbar-link{
      color:#fff;
      background:transparent;
      padding:0;
    }

    .feedback-request{
      margin-top:20px;
      background:#fff;
      border-radius:18px;
      border:1px solid var(--line);
      padding:18px;
      box-shadow:var(--shadow);
      display:grid;
      gap:12px;
    }
    .feedback-request h3{margin:0;}
    .feedback-request label{font-weight:600; color:var(--muted);}
    .feedback-request input,
    .feedback-request textarea{
      width:100%;
      border-radius:12px;
      border:1px solid var(--line);
      padding:12px;
      font-family:inherit;
    }
    .feedback-request textarea{min-height:140px;}
    .feedback-request-actions{
      display:flex;
      gap:12px;
      flex-wrap:wrap;
    }
  </style>
</head>

<body>
  <div class="help-app">
    <section class="hero">
      <div class="hero-inner">
        <h1>Gr√ºezi! Was ist deine Frage?</h1>
        <p>Finde Antworten rund um Endreinigung, Wohnungs√ºbergabe und Mietrecht ‚Äì kompakt, klar und in deinem Stil.</p>

        <div class="search-wrap" aria-label="Hilfe durchsuchen">
          <div class="searchbar">
            <span>üîç</span>
            <input id="searchInput" type="search" placeholder="Thema suchen (z.B. Abnahmeprotokoll, Kaution, Besenrein)" />
            <button class="search-btn" id="searchBtn" type="button">Suche</button>
          </div>
          <div class="search-suggestions" id="searchSuggestions" aria-live="polite"></div>
        </div>
      </div>
    </section>

    <main class="container">
      <section id="helpHome" class="view active" aria-label="Kategorien">
        <div class="category-grid" id="categoryGrid"></div>
      </section>

      <section id="helpSearch" class="view" aria-label="Suchergebnisse">
        <div class="search-results-head">
          <div>
            <h2 id="searchResultsTitle">Suchergebnisse</h2>
            <div class="search-results-meta" id="searchResultsMeta">Gib oben einen Begriff ein.</div>
          </div>
        </div>

        <div class="search-results-grid" id="searchResults"></div>

        <div class="feedback-request" id="searchRequest">
          <h3>Nichts passendes gefunden?</h3>
          <p>Schick uns deine Frage ‚Äì wir erg√§nzen den passenden Artikel.</p>

          <button class="btn btn-primary" id="openSearchRequest" type="button">Frage stellen</button>

          <form id="searchRequestForm" style="display:none;">
            <label for="requestTitle">Titel</label>
            <input id="requestTitle" type="text" placeholder="Kurz zusammengefasst" />

            <label for="requestEmail">E-Mail</label>
            <input id="requestEmail" type="email" placeholder="dein.name@email.com" />

            <label for="requestDescription">Beschreibung</label>
            <textarea id="requestDescription"></textarea>

            <div class="feedback-request-actions">
              <button class="btn btn-primary" id="submitSearchRequest" type="button">Absenden</button>
              <button class="btn btn-outline" id="cancelSearchRequest" type="button">Abbrechen</button>
            </div>
          </form>
        </div>
      </section>

      <section id="helpCategory" class="view" aria-label="Kategorie">
        <div class="toolbar">
          <button class="link-btn toolbar-link" id="backToHome">‚Üê Zur√ºck zur √úbersicht</button>
        </div>

        <div class="category-layout">
          <nav class="category-tabs" id="categoryTabs">
            <h4>Kategorien</h4>
          </nav>

          <div>
            <div class="category-header">
              <h2 id="categoryTitle"></h2>
              <p id="categorySubtitle"></p>
            </div>
            <div class="subcat-grid" id="subcategoryGrid"></div>
          </div>
        </div>
      </section>

      <section id="helpArticle" class="view" aria-label="Artikel">
        <div class="toolbar">
          <button class="link-btn toolbar-link" id="backToCategory">‚Üê Zur√ºck zur Kategorie</button>
        </div>

        <div class="article-layout">
          <article class="article-card" id="articleContent"></article>
          <aside class="article-nav" id="articleNav"></aside>
        </div>
      </section>
    </main>
  </div>

  <script>
    /**
     * WICHTIG:
     * 1) Lege deinen bestehenden helpData-Block (dein grosses Array) hier wieder rein.
     * 2) Zus√§tzlich werden Markdown-Artikel aus ./data/search-index.json geladen und durchsuchbar gemacht.
     *
     * Erwarteter Pfad (nach Build im docs-Output):
     *   docs/help/data/search-index.json
     */

    /* === 1) DEIN BESTEHENDES HELPDATA HIER EINSETZEN (oder drin lassen) === */
    const helpData = [
      /* Beispiel (ersetzen durch dein echtes helpData):
      {
        id: "allgemeines",
        title: "Allgemeines",
        subtitle: "Vorbereitung & praktische Tipps",
        icon: "üìå",
        description: "Checklisten, Dokumente und reibungslose Abl√§ufe.",
        topics: [
          {
            id: "allgemeines-checkliste",
            title: "Auszugs-Checkliste",
            icon: "‚úÖ",
            description: "So beh√§ltst du den √úberblick bis zur Abgabe.",
            keywords: ["Checkliste", "Vorbereitung"],
            articles: [
              {
                id: "allgemeines-plan",
                question: "Welche Schritte sollte ich vor der √úbergabe zuerst planen?",
                answer: "Plane mindestens zwei Wochen Puffer ...",
                extras: ["Punkt 1", "Punkt 2"],
                sources: ["Internes Know-how"]
              }
            ]
          }
        ]
      }
      */
    ];

    /* === 2) DOM === */
    const views = {
      home: document.getElementById("helpHome"),
      search: document.getElementById("helpSearch"),
      category: document.getElementById("helpCategory"),
      article: document.getElementById("helpArticle")
    };

    const categoryGrid = document.getElementById("categoryGrid");
    const categoryTabs = document.getElementById("categoryTabs");
    const subcategoryGrid = document.getElementById("subcategoryGrid");
    const categoryTitle = document.getElementById("categoryTitle");
    const categorySubtitle = document.getElementById("categorySubtitle");
    const articleContent = document.getElementById("articleContent");
    const articleNav = document.getElementById("articleNav");

    const backToHome = document.getElementById("backToHome");
    const backToCategory = document.getElementById("backToCategory");

    const searchInput = document.getElementById("searchInput");
    const searchBtn = document.getElementById("searchBtn");
    const searchSuggestions = document.getElementById("searchSuggestions");
    const searchResults = document.getElementById("searchResults");
    const searchResultsMeta = document.getElementById("searchResultsMeta");
    const searchResultsTitle = document.getElementById("searchResultsTitle");

    const searchRequest = document.getElementById("searchRequest");
    const openSearchRequest = document.getElementById("openSearchRequest");
    const searchRequestForm = document.getElementById("searchRequestForm");
    const submitSearchRequest = document.getElementById("submitSearchRequest");
    const cancelSearchRequest = document.getElementById("cancelSearchRequest");

    const requestTitle = document.getElementById("requestTitle");
    const requestEmail = document.getElementById("requestEmail");
    const requestDescription = document.getElementById("requestDescription");

    /* === 3) STATE === */
    let activeCategory = null;
    let lastSearchQuery = "";
    let articleBackTarget = "category";

    // Kombinierter Index: (A) interne helpData + (B) mdIndex aus search-index.json
    let searchIndex = [];
    let mdIndex = []; // Rohdaten aus ./data/search-index.json

    /* === 4) UTIL === */
    const showView = (viewName) => {
      Object.values(views).forEach(view => view.classList.remove("active"));
      views[viewName].classList.add("active");
    };

    const scrollToElement = (element) => {
      if (!element) return;
      const offset = 120;
      requestAnimationFrame(() => {
        const top = element.getBoundingClientRect().top + window.scrollY - offset;
        window.scrollTo({ top, behavior: "smooth" });
      });
    };

    const escapeHtml = (str) => {
      return String(str || "")
        .replaceAll("&", "&amp;")
        .replaceAll("<", "&lt;")
        .replaceAll(">", "&gt;")
        .replaceAll('"', "&quot;")
        .replaceAll("'", "&#039;");
    };

    const stripMarkdown = (markdown) => {
      return String(markdown || "")
        .replace(/```[\s\S]*?```/g, " ")
        .replace(/`[^`]*`/g, " ")
        .replace(/!\[[^\]]*\]\([^)]+\)/g, " ")
        .replace(/\[[^\]]*\]\([^)]+\)/g, " ")
        .replace(/[#>*_~\-]/g, " ")
        .replace(/\s+/g, " ")
        .trim();
    };

    const buildSummary = (text) => {
      if (!text) return "";
      const clipped = text.slice(0, 320);
      const end = clipped.lastIndexOf(".");
      return (end > 120 ? clipped.slice(0, end + 1) : clipped).trim();
    };

    const normalizeCategoryId = (cat) => {
      const s = String(cat || "").toLowerCase();
      if (s.includes("reinig")) return "reinigung";
      if (s.includes("√ºberg") || s.includes("ueberg")) return "uebergabe";
      if (s.includes("schad") || s.includes("abnutz")) return "schaeden";
      if (s.includes("kaut") || s.includes("depot")) return "kaution";
      return "allgemeines";
    };

    /* === 5) RENDER: HOME === */
    const renderHome = () => {
      categoryGrid.innerHTML = (helpData || []).map(category => `
        <button class="category-card" data-category="${escapeHtml(category.id)}" type="button">
          <span class="category-icon">${escapeHtml(category.icon || "üìå")}</span>
          <h3>${escapeHtml(category.title || "")}</h3>
          <p>${escapeHtml(category.subtitle || "")}</p>
        </button>
      `).join("");

      categoryGrid.querySelectorAll("button").forEach(button => {
        button.addEventListener("click", () => {
          const categoryId = button.dataset.category;
          const category = (helpData || []).find(item => item.id === categoryId);
          if (!category) return;
          renderCategory(category);
        });
      });
    };

    const renderCategoryTabs = (categoryId) => {
      categoryTabs.innerHTML = `<h4>Kategorien</h4>` + (helpData || []).map(category => `
        <div class="category-tab ${category.id === categoryId ? "active" : ""}" data-category="${escapeHtml(category.id)}">
          <span>${escapeHtml(category.icon || "üìå")}</span>
          <span>${escapeHtml(category.title || "")}</span>
        </div>
      `).join("");

      categoryTabs.querySelectorAll(".category-tab").forEach(tab => {
        tab.addEventListener("click", () => {
          const newCategory = (helpData || []).find(item => item.id === tab.dataset.category);
          if (!newCategory) return;
          renderCategory(newCategory);
        });
      });
    };

    const renderCategory = (category) => {
      activeCategory = category;
      articleBackTarget = "category";

      categoryTitle.textContent = category.title || "";
      categorySubtitle.textContent = category.description || "";

      renderCategoryTabs(category.id);

      subcategoryGrid.innerHTML = (category.topics || []).map(topic => `
        <div class="subcat-card" data-topic="${escapeHtml(topic.id)}">
          <span class="subcat-icon">${escapeHtml(topic.icon || "‚ú®")}</span>
          <h3>${escapeHtml(topic.title || "")}</h3>
          <p>${escapeHtml(topic.description || "")}</p>
          <ul class="subcat-list">
            ${(topic.articles || []).map(article => `
              <li><button class="link-btn subcat-link" data-topic="${escapeHtml(topic.id)}" data-article="${escapeHtml(article.id)}" type="button">${escapeHtml(article.question || "")}</button></li>
            `).join("")}
          </ul>
        </div>
      `).join("");

      subcategoryGrid.querySelectorAll(".subcat-link").forEach(button => {
        button.addEventListener("click", () => {
          const topic = (category.topics || []).find(item => item.id === button.dataset.topic);
          if (!topic) return;
          const article = (topic.articles || []).find(item => item.id === button.dataset.article);
          if (!article) return;
          renderArticle(category, topic, article);
        });
      });

      showView("category");
      scrollToElement(views.category.querySelector(".toolbar"));
    };

    /* === 6) RENDER: ARTIKEL (interne Artikel aus helpData) === */
    const renderArticle = (category, topic, article) => {
      if (article.likes === undefined) article.likes = 0;

      backToCategory.textContent = (articleBackTarget === "search")
        ? "‚Üê Zur√ºck zu den Suchergebnissen"
        : "‚Üê Zur√ºck zur Kategorie";

      const sources = Array.isArray(article.sources) ? article.sources : [];
      const sourceLinks = sources.map((source, index) => `
        <a class="source-pill" href="#source-${index}">${escapeHtml(source)}</a>
      `).join("");

      const extrasMarkup = (article.extras && article.extras.length)
        ? `
          <div class="article-section" id="section-extras">
            <h3>Zusatzinfos</h3>
            <ul>
              ${article.extras.map(item => `<li>${escapeHtml(item)}</li>`).join("")}
            </ul>
          </div>
        `
        : "";

      const sourcesMarkup = `
        <div class="article-section" id="section-sources">
          <h3>Quellen</h3>
          <ul>
            ${sources.map((source, index) => `<li id="source-${index}">${escapeHtml(source)}</li>`).join("")}
          </ul>
        </div>
      `;

      articleContent.innerHTML = `
        <div class="breadcrumb">
          <button class="link-btn breadcrumb-link" data-action="home" type="button">Help Center</button>
          <span>‚Ä¢</span>
          <button class="link-btn breadcrumb-link" data-action="category" type="button">${escapeHtml(category.title || "")}</button>
          <span>‚Ä¢</span>
          <button class="link-btn breadcrumb-link" data-action="topic" type="button">${escapeHtml(topic.title || "")}</button>
          <span class="pill">Kategorie: ${escapeHtml(category.title || "")}</span>
        </div>

        <div class="article-header">
          <h2>${escapeHtml(article.question || "")}</h2>
          <div class="like-counter" id="likeCounter">üíú ${article.likes}</div>
        </div>

        <p>${escapeHtml(topic.description || "")}</p>

        ${sources.length ? `
          <div class="source-bar">
            <span>Quellen:</span>
            <div class="source-links">${sourceLinks}</div>
          </div>
        ` : ""}

        <div class="article-section" id="section-answer">
          <h3>Antwort</h3>
          <p>${escapeHtml(article.answer || "")}</p>
        </div>

        ${extrasMarkup}
        ${sources.length ? sourcesMarkup : ""}

        <div class="feedback" id="feedback">
          <h4>War der Artikel hilfreich?</h4>
          <div class="feedback-actions">
            <button class="btn btn-primary" data-feedback="yes" type="button">Ja klar</button>
            <button class="btn btn-outline" data-feedback="no" type="button">Nicht wirklich</button>
          </div>

          <div class="feedback-quick" id="feedbackQuick" style="display:none;">
            <input type="text" placeholder="Optional: kurzer Kommentar" />
            <button class="btn btn-primary" type="button">Feedback senden</button>
          </div>

          <div class="feedback-thanks" id="feedbackThanks" style="display:none;">
            Danke! Dein Feedback hilft uns, die Inhalte weiter zu verbessern.
          </div>

          <form class="feedback-form" id="feedbackForm" style="display:none;">
            <div class="feedback-options">
              <label><input type="radio" name="feedbackReason" /> Dieser Artikel hat meine Fragen nicht beantwortet</label>
              <label><input type="radio" name="feedbackReason" /> Ich fand diesen Artikel verwirrend oder schwer lesbar</label>
              <label><input type="radio" name="feedbackReason" /> Mir gef√§llt nicht, wie der Ablauf erkl√§rt wurde</label>
              <label><input type="radio" name="feedbackReason" /> Sonstiges</label>
            </div>
            <textarea placeholder="Gibt es noch etwas, das du uns mitteilen m√∂chtest?"></textarea>
            <button class="btn btn-primary" type="button">Feedback senden</button>
          </form>
        </div>
      `;

      articleNav.innerHTML = `
        <h4>In diesem Artikel</h4>
        <a href="#section-answer">Antwort</a>
        ${(article.extras && article.extras.length) ? `<a href="#section-extras">Zusatzinfos</a>` : ""}
        ${sources.length ? `<a href="#section-sources">Quellen</a>` : ""}
      `;

      // Breadcrumb
      articleContent.querySelectorAll(".breadcrumb-link").forEach(link => {
        link.addEventListener("click", () => {
          const action = link.dataset.action;
          if (action === "home") {
            showView("home");
            scrollToElement(categoryGrid);
            return;
          }
          renderCategory(category);
        });
      });

      // Smooth scroll Quellen-Pills
      articleContent.querySelectorAll(".source-pill").forEach(pill => {
        pill.addEventListener("click", (event) => {
          event.preventDefault();
          const target = articleContent.querySelector(pill.getAttribute("href"));
          scrollToElement(target);
        });
      });

      // Smooth scroll Article nav
      articleNav.querySelectorAll("a").forEach(link => {
        link.addEventListener("click", (event) => {
          event.preventDefault();
          const target = articleContent.querySelector(link.getAttribute("href"));
          scrollToElement(target);
        });
      });

      // Feedback UI
      const feedbackButtons = articleContent.querySelectorAll("[data-feedback]");
      const feedbackForm = articleContent.querySelector("#feedbackForm");
      const feedbackThanks = articleContent.querySelector("#feedbackThanks");
      const feedbackQuick = articleContent.querySelector("#feedbackQuick");
      const feedbackActions = articleContent.querySelector(".feedback-actions");
      const likeCounter = articleContent.querySelector("#likeCounter");

      feedbackButtons.forEach(button => {
        button.addEventListener("click", () => {
          const value = button.dataset.feedback;
          if (value === "yes") {
            article.likes += 1;
            likeCounter.textContent = `üíú ${article.likes}`;
            feedbackActions.style.display = "none";
            feedbackQuick.style.display = "grid";
            feedbackThanks.style.display = "none";
            feedbackForm.style.display = "none";
          } else {
            feedbackActions.style.display = "none";
            feedbackQuick.style.display = "none";
            feedbackThanks.style.display = "none";
            feedbackForm.style.display = "grid";
          }
        });
      });

      showView("article");
      scrollToElement(views.article.querySelector(".toolbar"));
    };

    /* === 7) MARKDOWN INDEX LADEN (aus docs/help/data/search-index.json) === */
    const loadMdSearchIndex = async () => {
      try {
        // cache buster (wenn Vercel cached)
        const url = `./data/search-index.json?t=${Date.now()}`;
        const res = await fetch(url, { cache: "no-store" });
        if (!res.ok) return [];
        const data = await res.json();
        return Array.isArray(data) ? data : [];
      } catch (e) {
        console.warn("search-index.json konnte nicht geladen werden:", e);
        return [];
      }
    };

    /* === 8) SEARCH INDEX BAUEN (helpData + mdIndex) === */
    const buildSearchIndex = () => {
      const internal = (helpData || []).flatMap(category =>
        (category.topics || []).flatMap(topic =>
          (topic.articles || []).map(article => {
            const keywordText = (topic.keywords || []).join(" ").toLowerCase();
            const articleKeywords = (article.keywords || []).join(" ").toLowerCase();
            const extrasText = (article.extras || []).join(" ").toLowerCase();
            const fullText = (article.fullText || "").toLowerCase();
            const answer = (article.answer || "").toLowerCase();

            return {
              kind: "internal",
              category,
              topic,
              article,
              categoryIdForTag: category.id || "allgemeines",
              question: (article.question || "").toLowerCase(),
              topicTitle: (topic.title || "").toLowerCase(),
              keywordText,
              bodyText: `${answer} ${fullText} ${extrasText}`.toLowerCase(),
              content: `${category.title || ""} ${category.subtitle || ""} ${topic.title || ""} ${topic.description || ""} ${keywordText} ${articleKeywords} ${article.question || ""} ${article.answer || ""} ${fullText} ${extrasText}`.toLowerCase(),
              snippet: article.answer || buildSummary(article.fullText || "")
            };
          })
        )
      );

      const md = (mdIndex || []).map(entry => {
        const title = entry.title || entry.question || entry.id || "Artikel";
        const text = entry.text || entry.fullText || "";
        const excerpt = entry.excerpt || buildSummary(stripMarkdown(text));
        const catId = normalizeCategoryId(entry.category || entry.cat || "");

        const content = `${title} ${(entry.category || "")} ${(Array.isArray(entry.tags) ? entry.tags.join(" ") : "")} ${excerpt} ${text}`.toLowerCase();

        return {
          kind: "md",
          url: entry.url || entry.path || "",
          categoryIdForTag: catId,
          titleRaw: title,
          content,
          snippet: excerpt,
          // f√ºrs Scoring
          question: String(title).toLowerCase(),
          topicTitle: "",
          keywordText: String((Array.isArray(entry.tags) ? entry.tags.join(" ") : "")).toLowerCase(),
          bodyText: `${excerpt} ${text}`.toLowerCase(),
          // Damit Render-Funktionen einheitlich arbeiten k√∂nnen:
          category: { id: catId, title: (entry.category || "Artikel") },
          topic: { id: "md", title: "Blog", description: "" },
          article: { id: entry.id || title, question: title, answer: excerpt, sources: [], extras: [] }
        };
      });

      searchIndex = [...internal, ...md];
    };

    const matchResults = (query) => {
      const terms = query.toLowerCase().split(/\s+/).filter(Boolean);
      if (!terms.length) return [];

      return searchIndex
        .map(item => {
          const score = terms.reduce((total, term) => {
            if (!item.content.includes(term)) return total;

            const inQuestion = item.question.includes(term) ? 3 : 0;
            const inTopic = item.topicTitle.includes(term) ? 2 : 0;
            const inKeywords = item.keywordText.includes(term) ? 2 : 0;
            const inBody = item.bodyText.includes(term) ? 1 : 0;

            return total + inQuestion + inTopic + inKeywords + inBody;
          }, 0);

          return { ...item, score };
        })
        .filter(item => item.score > 0)
        .sort((a, b) => b.score - a.score);
    };

    /* === 9) SUGGESTIONS === */
    const closeSuggestions = () => {
      searchSuggestions.classList.remove("active");
      searchSuggestions.innerHTML = "";
    };

    const openRequestFromSuggestion = (query) => {
      // √∂ffnet Search-View + Request-Form direkt
      lastSearchQuery = query || "";
      showView("search");

      searchResultsMeta.textContent = query
        ? `Keine Treffer f√ºr ‚Äû${query}‚Äú`
        : "Keine Treffer.";

      searchResults.innerHTML = "";
      requestDescription.value = (query ? `Ich habe gesucht nach: ${query}.\n\nMeine Frage:` : "Ich habe keine passende Antwort gefunden.\n\nMeine Frage:").trim();

      searchRequestForm.style.display = "grid";
      openSearchRequest.style.display = "none";
      scrollToElement(searchRequest);
      closeSuggestions();
    };

    const renderSuggestions = (query) => {
      const q = (query || "").trim();
      if (!q) { closeSuggestions(); return; }

      const results = matchResults(q).slice(0, 4);

      // Wenn keine Resultate -> trotzdem Vorschlag anzeigen
      if (!results.length) {
        searchSuggestions.classList.add("active");
        searchSuggestions.innerHTML = `
          <button class="search-suggestion" type="button" data-action="request">
            <strong>Nichts passendes gefunden</strong>
            <small>Frage stellen ‚Äì wir erg√§nzen den passenden Artikel.</small>
          </button>
        `;
        searchSuggestions.querySelector("[data-action='request']").addEventListener("click", () => {
          openRequestFromSuggestion(q);
        });
        return;
      }

      searchSuggestions.classList.add("active");
      searchSuggestions.innerHTML = results.map(result => `
        <button class="search-suggestion" type="button"
          data-kind="${escapeHtml(result.kind)}"
          data-category="${escapeHtml(result.category?.id || '')}"
          data-topic="${escapeHtml(result.topic?.id || '')}"
          data-article="${escapeHtml(result.article?.id || '')}"
          data-url="${escapeHtml(result.url || '')}">
          <strong>${escapeHtml(result.article?.question || result.titleRaw || "Artikel")}</strong>
          <span class="category-tag" data-category="${escapeHtml(result.categoryIdForTag || 'allgemeines')}">
            ${escapeHtml(result.category?.title || "Artikel")}
          </span>
        </button>
      `).join("");

      searchSuggestions.querySelectorAll(".search-suggestion").forEach(item => {
        item.addEventListener("click", () => {
          const kind = item.dataset.kind;

          if (kind === "md") {
            const url = item.dataset.url;
            if (url) window.location.href = url;
            closeSuggestions();
            return;
          }

          const category = (helpData || []).find(entry => entry.id === item.dataset.category);
          if (!category) return;
          const topic = (category.topics || []).find(entry => entry.id === item.dataset.topic);
          if (!topic) return;
          const article = (topic.articles || []).find(entry => entry.id === item.dataset.article);
          if (!article) return;

          renderArticle(category, topic, article);
          closeSuggestions();
        });
      });
    };

    /* === 10) SEARCH RESULTS VIEW === */
    const renderSearchResults = (query) => {
      const q = (query || "").trim();
      const results = q ? matchResults(q) : [];

      lastSearchQuery = q;
      articleBackTarget = "search";

      searchResultsMeta.textContent = results.length
        ? `${results.length} passende Artikel f√ºr ‚Äû${q}‚Äú`
        : `Keine Treffer f√ºr ‚Äû${q}‚Äú`;

      searchResults.innerHTML = results.map(result => `
        <div class="search-result-card"
          data-kind="${escapeHtml(result.kind)}"
          data-category="${escapeHtml(result.category?.id || '')}"
          data-topic="${escapeHtml(result.topic?.id || '')}"
          data-article="${escapeHtml(result.article?.id || '')}"
          data-url="${escapeHtml(result.url || '')}">
          <h3>${escapeHtml(result.article?.question || result.titleRaw || "Artikel")}</h3>
          <span class="category-tag" data-category="${escapeHtml(result.categoryIdForTag || 'allgemeines')}">
            ${escapeHtml(result.category?.title || "Artikel")}
          </span>
          <p>${escapeHtml(result.snippet || "")}</p>
        </div>
      `).join("");

      searchResults.querySelectorAll(".search-result-card").forEach(card => {
        card.addEventListener("click", () => {
          const kind = card.dataset.kind;

          if (kind === "md") {
            const url = card.dataset.url;
            if (url) window.location.href = url;
            return;
          }

          const category = (helpData || []).find(entry => entry.id === card.dataset.category);
          if (!category) return;
          const topic = (category.topics || []).find(entry => entry.id === card.dataset.topic);
          if (!topic) return;
          const article = (topic.articles || []).find(entry => entry.id === card.dataset.article);
          if (!article) return;

          renderArticle(category, topic, article);
        });
      });

      showView("search");
      scrollToElement(searchResultsTitle);
    };

    const handleSearchSubmit = () => {
      const query = searchInput.value.trim();
      if (!query) {
        showView("home");
        closeSuggestions();
        return;
      }
      renderSearchResults(query);
      closeSuggestions();
    };

    /* === 11) NAV / EVENTS === */
    backToHome.addEventListener("click", () => showView("home"));
    backToCategory.addEventListener("click", () => {
      if (articleBackTarget === "search") {
        showView("search");
        scrollToElement(searchResultsTitle);
      } else {
        renderCategory(activeCategory);
      }
    });

    searchInput.addEventListener("input", (event) => renderSuggestions(event.target.value));
    searchInput.addEventListener("keydown", (event) => {
      if (event.key === "Enter") {
        event.preventDefault();
        handleSearchSubmit();
      }
      if (event.key === "Escape") {
        closeSuggestions();
      }
    });

    // Klick ausserhalb -> Suggestions zu
    document.addEventListener("click", (e) => {
      const wrap = document.querySelector(".search-wrap");
      if (!wrap) return;
      if (!wrap.contains(e.target)) closeSuggestions();
    });

    searchBtn.addEventListener("click", handleSearchSubmit);

    openSearchRequest.addEventListener("click", () => {
      const queryText = lastSearchQuery
        ? `Ich habe gesucht nach: ${lastSearchQuery}.`
        : "Ich habe keine passende Antwort gefunden.";

      requestDescription.value = `${queryText}\n\nMeine Frage:`.trim();
      searchRequestForm.style.display = "grid";
      openSearchRequest.style.display = "none";
      scrollToElement(searchRequest);
    });

    cancelSearchRequest.addEventListener("click", () => {
      searchRequestForm.style.display = "none";
      openSearchRequest.style.display = "inline-flex";
    });

    submitSearchRequest.addEventListener("click", () => {
      const title = requestTitle.value.trim();
      const email = requestEmail.value.trim();
      const description = requestDescription.value.trim();

      const subject = encodeURIComponent(`Help Anfrage: ${title || "Neue Anfrage"}`);
      const body = encodeURIComponent(
        `Titel: ${title || "-"}\nE-Mail: ${email || "-"}\n\nBeschreibung:\n${description || "-"}`
      );

      window.location.href = `mailto:easycleany@outlook.com?subject=${subject}&body=${body}`;
    });

    /* === 12) INIT === */
    const initializeHelp = async () => {
      // Markdown-Index laden (aus docs/help/data/search-index.json)
      mdIndex = await loadMdSearchIndex();

      // Indizes bauen
      buildSearchIndex();

      // UI rendern
      renderHome();
    };

    initializeHelp();
  </script>
</body>
</html>
