<!doctype html>
<html lang="de">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Help | Easy Cleany</title>
  <style>
    :root{
      --bg:#efe6f8;
      --card:#ffffff;
      --text:#1d1330;
      --muted:#6a5f7d;
      --line:#e9e1f3;
      --accent:#833CCF;
      --accent-dark:#5f1fa1;
      --accent-soft:rgba(131,60,207,0.12);
      --accent-soft-2:rgba(131,60,207,0.06);
      --shadow:0 16px 40px rgba(26,17,43,.12);
      --radius:18px;
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      background:var(--bg);
      font-family: ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, Arial, "Noto Sans", sans-serif;
      color:var(--text);
    }
    button{font:inherit;}
    a{color:inherit; text-decoration:none;}
    .help-app{min-height:100vh;}

    .hero{
      background:
        radial-gradient(1200px 520px at 10% 0%, rgba(255,255,255,.08), rgba(0,0,0,0)),
        radial-gradient(600px 300px at 90% 30%, rgba(255,177,80,.35), rgba(0,0,0,0)),
        linear-gradient(135deg, #5a1d99 0%, #833CCF 60%, #4a1d76 100%);
      color:#fff;
      padding:70px 20px 90px;
      position:relative;
      overflow:hidden;
    }
    .hero::before,
    .hero::after{
      content:"";
      position:absolute;
      border-radius:999px;
      opacity:.65;
    }
    .hero::before{
      width:260px; height:260px;
      background:#4fd1ff;
      bottom:-120px; left:-80px;
    }
    .hero::after{
      width:180px; height:180px;
      background:#ff9f66;
      top:-70px; right:-50px;
    }
    .hero-inner{
      max-width:1100px;
      margin:0 auto;
      text-align:center;
      position:relative;
      z-index:1;
    }
    .hero h1{
      margin:0 0 16px;
      font-size:clamp(2.2rem, 4vw, 3.6rem);
      font-weight:900;
      letter-spacing:-0.02em;
      color:#fff;
    }
    .hero p{
      margin:0 0 24px;
      font-size:1.05rem;
      color:rgba(255,255,255,.85);
    }
    .searchbar{
      max-width:680px;
      margin:0 auto;
      background:#fff;
      border-radius:16px;
      display:flex;
      align-items:center;
      gap:10px;
      padding:14px 18px;
      box-shadow:var(--shadow);
      color:var(--muted);
    }
    .searchbar span{font-size:1.1rem;}
    .searchbar input{
      border:none;
      outline:none;
      flex:1;
      font-size:1.15rem;
    }
    .search-btn{
      border:none;
      background:var(--accent);
      color:#fff;
      padding:12px 20px;
      border-radius:12px;
      font-weight:700;
      cursor:pointer;
      box-shadow:0 8px 18px rgba(26,17,43,.18);
    }
    .search-suggestions{
      max-width:680px;
      margin:12px auto 0;
      background:#fff;
      border-radius:14px;
      border:1px solid var(--line);
      box-shadow:var(--shadow);
      display:none;
      overflow:hidden;
      text-align:left;
    }
    .search-suggestions.active{display:block;}
    .search-suggestion{
      padding:12px 16px;
      border-bottom:1px solid var(--line);
      cursor:pointer;
      font-weight:600;
      color:var(--muted);
      display:flex;
      flex-direction:column;
      gap:6px;
    }
    .search-suggestion:last-child{border-bottom:none;}
    .search-suggestion strong{color:var(--accent-dark);}

    .container{
      max-width:1200px;
      margin:0 auto;
      padding:40px 20px 80px;
    }

    .view{display:none;}
    .view.active{display:block;}

    .category-grid{
      display:grid;
      grid-template-columns:repeat(3, minmax(0, 1fr));
      gap:22px;
      margin-top:30px;
    }
    @media (max-width: 980px){
      .category-grid{grid-template-columns:repeat(2, minmax(0, 1fr));}
    }
    @media (max-width: 640px){
      .category-grid{grid-template-columns:1fr;}
    }
    .category-card{
      background:var(--card);
      border-radius:20px;
      padding:28px 24px;
      box-shadow:var(--shadow);
      border:1px solid rgba(131,60,207,.18);
      display:flex;
      flex-direction:column;
      align-items:center;
      text-align:center;
      gap:14px;
      cursor:pointer;
      transition:transform .15s ease, border-color .15s ease;
    }
    .category-card:hover{transform:translateY(-3px); border-color:rgba(131,60,207,.4);}
    .category-icon{
      width:88px; height:88px;
      display:grid; place-items:center;
      border-radius:24px;
      background:var(--accent-soft);
      font-size:2.4rem;
    }
    .category-card h3{
      margin:0;
      font-size:1.3rem;
      font-weight:800;
    }
    .category-card p{
      margin:0;
      color:var(--muted);
      font-size:1rem;
      line-height:1.4;
    }

    .category-layout{
      display:grid;
      grid-template-columns:220px 1fr;
      gap:26px;
      align-items:start;
    }
    @media (max-width: 900px){
      .category-layout{grid-template-columns:1fr;}
    }
    .category-tabs{
      background:#fff;
      border-radius:18px;
      border:1px solid var(--line);
      padding:12px;
      box-shadow:var(--shadow);
      position:sticky;
      top:20px;
    }
    .category-tabs h4{
      margin:6px 10px 12px;
      font-size:.9rem;
      color:var(--muted);
      font-weight:800;
      text-transform:uppercase;
      letter-spacing:.08em;
    }
    .category-tab{
      display:flex;
      align-items:center;
      gap:10px;
      padding:10px 12px;
      border-radius:14px;
      font-weight:700;
      color:var(--muted);
      cursor:pointer;
      transition:background .15s ease, color .15s ease;
    }
    .category-tab.active{
      background:var(--accent-soft);
      color:var(--accent-dark);
    }

    .category-header{
      background:#fff;
      border-radius:20px;
      border:1px solid var(--line);
      box-shadow:var(--shadow);
      padding:24px;
      margin-bottom:20px;
    }
    .category-header h2{
      margin:0 0 8px;
      font-size:1.8rem;
    }
    .category-header p{
      margin:0;
      color:var(--muted);
    }

    .subcat-grid{
      display:grid;
      grid-template-columns:1fr;
      gap:16px;
    }
    .subcat-card{
      background:#fff;
      border-radius:18px;
      border:1px solid var(--line);
      padding:18px;
      display:flex;
      flex-direction:column;
      gap:12px;
      box-shadow:var(--shadow);
      cursor:default;
      transition:transform .15s ease, border-color .15s ease;
    }
    .subcat-card:hover{border-color:var(--line);}
    .subcat-icon{
      width:48px; height:48px;
      border-radius:14px;
      display:grid; place-items:center;
      background:var(--accent-soft-2);
      font-size:1.4rem;
      color:var(--accent-dark);
    }
    .subcat-card h3{margin:0; font-size:1.25rem;}
    .subcat-card p{margin:0; color:var(--muted); font-size:1rem;}
    .subcat-list{
      margin:0;
      padding-left:18px;
      color:var(--muted);
      font-size:1rem;
      line-height:1.5;
      display:flex;
      flex-direction:column;
      gap:8px;
    }
    .subcat-section{display:flex; flex-direction:column; gap:8px;}
    .subcat-section.is-hidden{display:none;}
    .subcat-section-title{
      margin:8px 0 0;
      font-size:.95rem;
      font-weight:800;
      color:var(--accent-dark);
      text-transform:uppercase;
      letter-spacing:.04em;
    }
    .subcat-toggle{
      margin-top:6px;
      color:var(--accent-dark);
      font-weight:700;
      background:none;
      border:none;
      text-align:left;
      cursor:pointer;
      padding:0;
    }
    .subcat-list li{margin:0;}
    .subcat-link{
      color:var(--accent-dark);
      font-weight:600;
      text-decoration:none;
      background:none;
      border:none;
      padding:0;
      text-align:left;
    }
    .subcat-link:hover{text-decoration:underline;}

    .search-results-head{
      display:flex;
      justify-content:space-between;
      align-items:flex-end;
      gap:20px;
      margin-bottom:20px;
      background:linear-gradient(135deg, #5a1d99 0%, #833CCF 60%, #4a1d76 100%);
      color:#fff;
      padding:18px 20px;
      border-radius:18px;
    }
    .search-results-head h2{margin:0; color:#fff; font-size:2rem;}
    .search-results-meta{color:rgba(255,255,255,.85);}
    .search-results-grid{
      display:grid;
      gap:16px;
    }
    .search-result-card{
      background:#fff;
      border-radius:18px;
      border:1px solid var(--line);
      padding:18px;
      box-shadow:var(--shadow);
      cursor:pointer;
      transition:transform .15s ease, border-color .15s ease;
    }
    .search-result-card:hover{transform:translateY(-3px); border-color:rgba(131,60,207,.4);}
    .search-result-card h3{margin:0 0 10px; font-size:2rem;}
    .search-result-card p{
      margin:0;
      color:var(--muted);
      font-size:1.05rem;
      display:-webkit-box;
      -webkit-line-clamp:3;
      -webkit-box-orient:vertical;
      overflow:hidden;
    }
    .category-tag{
      display:inline-flex;
      align-items:center;
      justify-content:center;
      padding:6px 12px;
      border-radius:10px;
      font-weight:700;
      font-size:.75rem;
      color:#fff;
      width:max-content;
      margin:6px 0 12px;
    }
    .search-results-more{
      display:flex;
      justify-content:center;
      margin-top:18px;
    }
    .search-results-toggle{
      display:inline-flex;
      align-items:center;
      gap:6px;
    }
    .category-tag[data-category="reinigung"]{background:#6f3ccf;}
    .category-tag[data-category="uebergabe"]{background:#ff8c6a;}
    .category-tag[data-category="schaeden"]{background:#2e7dd7;}
    .category-tag[data-category="kaution"]{background:#1f9d6e;}
    .category-tag[data-category="allgemeines"]{background:#8b5a2b;}

    .article-layout{
      display:grid;
      grid-template-columns:1fr 260px;
      gap:30px;
      align-items:start;
    }
    @media (max-width: 980px){
      .article-layout{grid-template-columns:1fr;}
    }
    .article-card{
      background:#fff;
      border-radius:20px;
      border:1px solid var(--line);
      padding:26px;
      box-shadow:var(--shadow);
    }
    .breadcrumb{
      display:flex;
      flex-wrap:wrap;
      gap:8px;
      color:var(--muted);
      font-size:.9rem;
      margin-bottom:14px;
    }
    .breadcrumb span{
      display:inline-flex;
      align-items:center;
      gap:6px;
    }
    .pill{
      background:var(--accent-soft);
      color:var(--accent-dark);
      font-weight:700;
      padding:4px 10px;
      border-radius:999px;
      font-size:.8rem;
    }
    .article-card h2{
      margin:0;
      font-size:2rem;
    }
    .article-card p{
      color:var(--muted);
      line-height:1.6;
    }
    .article-section{margin-top:26px;}
    .article-section h3{
      margin:0 0 8px;
      font-size:1.2rem;
      color:var(--accent-dark);
    }
    .article-header{
      display:flex;
      align-items:flex-start;
      justify-content:space-between;
      gap:16px;
      margin-bottom:14px;
    }
    .like-counter{
      display:inline-flex;
      align-items:center;
      gap:6px;
      font-weight:700;
      color:var(--accent-dark);
      background:var(--accent-soft-2);
      padding:6px 10px;
      border-radius:999px;
      font-size:.85rem;
      white-space:nowrap;
    }
    .source-bar{
      margin:18px 0 10px;
      display:flex;
      flex-wrap:wrap;
      gap:10px;
      align-items:center;
      color:var(--muted);
      font-size:.92rem;
    }
    .source-links{
      display:flex;
      flex-wrap:wrap;
      gap:8px;
    }
    .source-pill{
      background:var(--accent-soft-2);
      color:var(--accent-dark);
      padding:6px 12px;
      border-radius:999px;
      font-weight:700;
      font-size:.82rem;
    }

    .article-nav{
      background:#fff;
      border-radius:18px;
      border:1px solid var(--line);
      padding:16px;
      box-shadow:var(--shadow);
      position:sticky;
      top:20px;
    }
    .article-nav h4{
      margin:6px 0 12px;
      font-size:.85rem;
      text-transform:uppercase;
      letter-spacing:.08em;
      color:var(--muted);
    }
    .article-nav a{
      display:block;
      padding:8px 10px;
      border-radius:12px;
      color:var(--muted);
      font-weight:600;
      font-size:.92rem;
    }
    .article-nav a:hover{background:var(--accent-soft-2); color:var(--accent-dark);}    

    .feedback{
      margin-top:32px;
      border-top:1px solid var(--line);
      padding-top:22px;
    }
    .feedback h4{margin:0 0 14px;}
    .feedback-actions{
      display:flex; gap:12px; flex-wrap:wrap;
    }
    .btn{
      border:1px solid var(--accent);
      background:#fff;
      color:var(--accent-dark);
      padding:10px 16px;
      border-radius:12px;
      cursor:pointer;
      font-weight:700;
    }
    .btn-primary{background:var(--accent); color:#fff;}
    .btn-outline{background:#fff;}

    .feedback-form,
    .feedback-quick{
      margin-top:16px;
      display:grid;
      gap:12px;
    }
    .feedback-form textarea,
    .feedback-quick input{
      width:100%;
      border-radius:12px;
      border:1px solid var(--line);
      padding:12px;
      font-family:inherit;
    }
    .feedback-quick input{min-height:48px;}
    .feedback-options{
      display:grid;
      gap:10px;
      color:var(--muted);
      font-size:.95rem;
    }
    .feedback-thanks{
      margin-top:16px;
      background:var(--accent-soft);
      color:var(--accent-dark);
      padding:16px;
      border-radius:14px;
      font-weight:700;
    }

    .toolbar{
      display:flex;
      gap:12px;
      flex-wrap:wrap;
      margin-bottom:18px;
    }
    .link-btn{
      border:none;
      background:transparent;
      color:var(--accent-dark);
      font-weight:700;
      cursor:pointer;
      padding:0;
    }
    .toolbar-link{
      color:#fff;
      background:transparent;
      padding:0;
    }
    .feedback-request{
      margin-top:20px;
      background:#fff;
      border-radius:18px;
      border:1px solid var(--line);
      padding:18px;
      box-shadow:var(--shadow);
      display:grid;
      gap:12px;
    }
    .feedback-request h3{margin:0;}
    .feedback-request label{font-weight:600; color:var(--muted);}
    .feedback-request input,
    .feedback-request textarea{
      width:100%;
      border-radius:12px;
      border:1px solid var(--line);
      padding:12px;
      font-family:inherit;
    }
    .feedback-request textarea{min-height:140px;}
    .feedback-request-actions{
      display:flex;
      gap:12px;
      flex-wrap:wrap;
    }
  </style>
</head>
<body>
  <div class="help-app">
    <section class="hero">
      <div class="hero-inner">
        <h1>Gr√ºezi! Was ist deine Frage?</h1>
        <p>Finde Antworten rund um Endreinigung, Wohnungs√ºbergabe und Mietrecht ‚Äì kompakt, klar und einfach erkl√§rt.</p>
        <div class="searchbar" aria-label="Hilfe durchsuchen">
          <span>üîç</span>
          <input id="searchInput" type="search" placeholder="Thema suchen (z.B. Abnahmeprotokoll, Kaution, Besenrein)" />
          <button class="search-btn" id="searchBtn" type="button">Suche</button>
        </div>
        <div class="search-suggestions" id="searchSuggestions" aria-live="polite"></div>
      </div>
    </section>

    <main class="container">
      <section id="helpHome" class="view active" aria-label="Kategorien">
        <div class="category-grid" id="categoryGrid"></div>
      </section>

      <section id="helpSearch" class="view" aria-label="Suchergebnisse">
        <div class="search-results-head">
          <div>
            <h2 id="searchResultsTitle">Suchergebnisse</h2>
            <div class="search-results-meta" id="searchResultsMeta">Gib oben einen Begriff ein.</div>
          </div>
          <button class="btn btn-outline" id="goToOverview" type="button">Zur √úbersicht</button>
        </div>
        <div class="search-results-grid" id="searchResults"></div>
        <div class="search-results-more" id="searchResultsMore"></div>
        <div class="feedback-request" id="searchRequest">
          <h3>Nichts passendes gefunden?</h3>
          <p>Schick uns deine Frage ‚Äì wir erg√§nzen den passenden Artikel.</p>
          <button class="btn btn-primary" id="openSearchRequest" type="button">Frage stellen</button>
          <form id="searchRequestForm" style="display:none;">
            <label for="requestTitle">Titel</label>
            <input id="requestTitle" type="text" placeholder="Kurz zusammengefasst" />
            <label for="requestEmail">E-Mail</label>
            <input id="requestEmail" type="email" placeholder="dein.name@email.com" />
            <label for="requestDescription">Beschreibung</label>
            <textarea id="requestDescription"></textarea>
            <div class="feedback-request-actions">
              <button class="btn btn-primary" id="submitSearchRequest" type="button">Absenden</button>
              <button class="btn btn-outline" id="cancelSearchRequest" type="button">Abbrechen</button>
            </div>
          </form>
        </div>
      </section>

      <section id="helpCategory" class="view" aria-label="Kategorie">
        <div class="toolbar">
          <button class="link-btn toolbar-link" id="backToHome">‚Üê Zur√ºck zur √úbersicht</button>
        </div>
        <div class="category-layout">
          <nav class="category-tabs" id="categoryTabs">
            <h4>Kategorien</h4>
          </nav>
          <div>
            <div class="category-header">
              <h2 id="categoryTitle"></h2>
              <p id="categorySubtitle"></p>
            </div>
            <div class="subcat-grid" id="subcategoryGrid"></div>
          </div>
        </div>
      </section>

      <section id="helpArticle" class="view" aria-label="Artikel">
        <div class="toolbar">
          <button class="link-btn toolbar-link" id="backToCategory">‚Üê Zur√ºck zur Kategorie</button>
        </div>
        <div class="article-layout">
          <article class="article-card" id="articleContent"></article>
          <aside class="article-nav" id="articleNav"></aside>
        </div>
      </section>
    </main>
  </div>

  <script>
    const helpData = [
      {
        id: "reinigung",
        title: "Reinigung",
        subtitle: "Endreinigung der Wohnung",
        icon: "üßΩ",
        description: "Standards, Spezialf√§lle und Verantwortung bei der Endreinigung.",
        topics: [
          {
            id: "reinigung-standard",
            title: "√úbergabe-Standard",
            icon: "‚ú®",
            description: "Wie sauber muss es sein ‚Äì und wann reicht besenrein?",
            keywords: ["Endreinigung", "√úbergabe", "besenrein", "Renovation", "Sauberkeit"],
            articles: [
              {
                id: "reinigung-tipptopp",
                question: "Wie sauber muss die Wohnung bei der √úbergabe sein?",
                answer: "In der Regel muss eine Mietwohnung gr√ºndlich gereinigt √ºbergeben werden ‚Äì also tipptopp sauber in allen R√§umen. Dazu geh√∂ren B√∂den (fegen, staubsaugen, feucht aufnehmen), Fenster (innen und aussen), K√ºche (alle Ger√§te, Oberfl√§chen, Sp√ºle, Dampfabzug), Bad/WC (Sanit√§reinrichtungen gr√ºndlich putzen) sowie Schr√§nke, Keller oder Balkon. Kurz: so sauber, wie man sie selbst als neue Mieterin √ºbernehmen m√∂chte.",
                extras: ["Plane einen finalen Kontrollrundgang mit Checkliste, damit kein Raum vergessen geht.", "Fotos nach der Reinigung helfen, den Zustand zu dokumentieren."],
                sources: ["beobachter.ch", "newhome.ch", "mrcleaner.de"]
              },
              {
                id: "reinigung-besenrein",
                question: "Was bedeutet ‚Äûbesenrein‚Äú und reicht das bei der Wohnungsabgabe?",
                answer: "‚ÄûBesenrein‚Äú bedeutet nur grob gereinigt (besensauber, gefegt und oberfl√§chlich sauber). Das gen√ºgt nur, wenn es im Mietvertrag ausdr√ºcklich vereinbart ist ‚Äì oft gegen eine Reinigungspauschale. Selbst dann m√ºssen Bad und K√ºche gr√ºndlich gereinigt werden, da diese Bereiche nicht unter eine blosse Kehrrreinigung fallen.",
                extras: ["Pr√ºfe deinen Mietvertrag auf eine explizite Vereinbarung zur besenreinen R√ºckgabe.", "Bei Unklarheit lohnt sich eine kurze schriftliche Nachfrage bei der Vermietung."],
                sources: ["beobachter.ch"]
              },
              {
                id: "reinigung-renovation",
                question: "Die Wohnung wird nach meinem Auszug renoviert ‚Äì muss ich sie trotzdem putzen?",
                answer: "Bei einer umfassenden Renovation gen√ºgt es normalerweise, die Wohnung besenrein zu hinterlassen. Alles, was durch die Renovationsarbeiten ohnehin wieder schmutzig wird, muss nicht im Detail gereinigt werden. Die Baureinigung nach den Arbeiten ist Sache des Vermieters.",
                extras: ["Lass dir eine geplante Renovation m√∂glichst schriftlich best√§tigen.", "F√ºr K√ºche und Bad kann trotzdem eine Basisreinigung sinnvoll sein, um Diskussionen zu vermeiden."],
                sources: ["mieterverband.ch"]
              }
            ]
          },
          {
            id: "reinigung-spezial",
            title: "Reinigungsumfang & Spezialfl√§chen",
            icon: "ü™ü",
            description: "Teppiche, Fensterl√§den und heikle Arbeiten richtig einordnen.",
            keywords: ["Teppich shampoonieren", "Fensterl√§den", "Doppelfenster", "Sicherheitsarbeiten"],
            articles: [
              {
                id: "reinigung-teppich",
                question: "Muss ich Teppichb√∂den reinigen oder shampoonieren?",
                answer: "Ja, fest verlegte Teppichb√∂den sollten im Rahmen der Endreinigung gr√ºndlich gereinigt werden ‚Äì oft inklusive Shampoonieren, um Flecken oder tiefsitzenden Schmutz zu entfernen. Eine Ausnahme gilt, wenn der Vermieter den alten Teppich ohnehin unmittelbar nach dem Auszug ersetzt.",
                extras: ["Frage fr√ºhzeitig nach, ob ein Ersatz geplant ist, um unn√∂tige Kosten zu vermeiden.", "Bei empfindlichen Teppichen kann eine professionelle Reinigung sinnvoll sein."],
                sources: ["mieterverband.ch"]
              },
              {
                id: "reinigung-gefahr",
                question: "Muss ich gef√§hrliche oder spezielle Reinigungsarbeiten durchf√ºhren?",
                answer: "Nein. Mieterinnen und Mieter m√ºssen zwar gr√ºndlich reinigen, aber keine gef√§hrlichen Arbeiten ausf√ºhren. Aussen liegende Fensterl√§den auszuh√§ngen, an der Fassade zu klettern oder alte Doppelfenster zu zerlegen, kann nicht verlangt werden. Arbeiten mit Sicherheitsrisiko oder Fachkenntnis bleiben Aufgabe von Fachpersonen.",
                extras: ["Bei Unsicherheit hilft ein kurzer Hinweis an die Vermietung, dass die Arbeit risikobehaftet ist.", "Dokumentiere, welche Arbeiten du aus Sicherheitsgr√ºnden nicht durchgef√ºhrt hast."],
                sources: ["mieterverband.ch"]
              }
            ]
          },
          {
            id: "reinigung-orga",
            title: "Organisation & Verantwortung",
            icon: "üßæ",
            description: "Reinigungsfirma, Abnahmegarantie und Folgen bei M√§ngeln.",
            keywords: ["Reinigungsfirma", "Abnahmegarantie", "Nachreinigung", "Kosten"],
            articles: [
              {
                id: "reinigung-firma",
                question: "Muss ich eine professionelle Reinigungsfirma f√ºr die Endreinigung engagieren?",
                answer: "Nein, es besteht keine Pflicht. Sie d√ºrfen die Endreinigung selbst durchf√ºhren. Wichtig ist nur, dass die Wohnung am Ende sauber √ºbergeben wird. Eine Firma mit Abnahmegarantie kann jedoch Stress vermeiden und Nachreinigungen abdecken.",
                extras: ["Eine Offerte mit Abnahmegarantie kann hilfreich sein, wenn du wenig Zeit hast.", "Vergleiche die Leistungen (Fenster, Ofen, Keller) detailliert."],
                sources: ["mrcleaner.de"]
              },
              {
                id: "reinigung-nachreinigung",
                question: "Was passiert, wenn die Wohnung bei der Abgabe nicht sauber genug ist?",
                answer: "Die Vermieterseite muss Ihnen zuerst eine kurze Nachfrist zum Nachreinigen geben. Erst wenn die Wohnung danach immer noch nicht sauber ist, darf die Vermietung eine Reinigung organisieren und Ihnen die Kosten in Rechnung stellen.",
                extras: ["Reagiere schnell auf Beanstandungen und protokolliere, was nachgereinigt wurde.", "So lassen sich zus√§tzliche Kosten meist vermeiden."],
                sources: ["mieterverband.ch"]
              }
            ]
          }
        ]
      },
      {
        id: "uebergabe",
        title: "Wohnungs√ºbergabe",
        subtitle: "Ablauf & √úbergabeprotokoll",
        icon: "üóùÔ∏è",
        description: "Termine, Schl√ºssel, Protokoll und Abgabeablauf.",
        topics: [
          {
            id: "uebergabe-termine",
            title: "Termin & Schl√ºssel",
            icon: "üìÖ",
            description: "R√ºckgabezeitpunkt und √úbergabeform.",
            keywords: ["√úbergabetermin", "Schl√ºssel", "R√ºckgabe", "Fristen"],
            articles: [
              {
                id: "uebergabe-termin",
                question: "Bis wann muss ich am Auszugstermin die Wohnung √ºbergeben?",
                answer: "Die Wohnung ist sp√§testens am letzten Tag der Mietdauer w√§hrend der √ºblichen Gesch√§ftszeiten zur√ºckzugeben. Viele Mietvertr√§ge erlauben die Abgabe bis Mittag des folgenden Tages, wenn das Mietende auf einen Monatsletzten f√§llt. F√§llt der Termin auf ein Wochenende oder einen Feiertag, verschiebt er sich auf den n√§chsten Werktag.",
                extras: ["Vereinbare den Termin fr√ºhzeitig schriftlich, damit es keine Missverst√§ndnisse gibt.", "Halte den √úbergabezeitpunkt im Kalender und im √úbergabeprotokoll fest."],
                sources: ["mieterverband.ch"]
              },
              {
                id: "uebergabe-verweigerung",
                question: "Was, wenn der Vermieter die Wohnungsabnahme verweigert oder nicht erscheint?",
                answer: "Ihre Pflicht ist erf√ºllt, sobald die Wohnung ger√§umt ist und die Schl√ºssel fristgerecht √ºbergeben wurden. Erscheint niemand, informieren Sie die Vermietung schriftlich und dokumentieren die Schl√ºssel√ºbergabe. Im Zweifel senden Sie die Schl√ºssel per Einschreiben.",
                extras: ["Bewahre Postbelege oder Empfangsbest√§tigungen sorgf√§ltig auf.", "Ein Foto der Schl√ºssel√ºbergabe kann zus√§tzlich helfen."],
                sources: ["mieterverband.ch"]
              },
              {
                id: "uebergabe-frueh",
                question: "Kann ich die Wohnung schon vor dem Mietende √ºbergeben?",
                answer: "Ja, Sie k√∂nnen fr√ºher ausziehen und die Schl√ºssel abgeben. Schlagen Sie der Vermietung schriftlich einen fr√ºheren Termin vor. Wird der fr√ºhere Termin abgelehnt, k√∂nnen Sie die Schl√ºssel trotzdem per Einschreiben senden. Die Mietzahlungspflicht l√§uft bis Vertragsende weiter, eine Nutzungspflicht gibt es jedoch nicht.",
                extras: ["Biete einen konkreten Termin mit Zeitfenster an, um die Planung zu erleichtern.", "Dokumentiere den Zustand der Wohnung auch bei vorzeitiger Abgabe."],
                sources: ["mieterverband.ch"]
              }
            ]
          },
          {
            id: "uebergabe-protokoll",
            title: "Protokoll & Unterschrift",
            icon: "üìù",
            description: "Was gilt beim Abnahmeprotokoll und bei Unterschriften?",
            keywords: ["Abnahmeprotokoll", "Unterschrift", "Schuldanerkennung"],
            articles: [
              {
                id: "uebergabe-unterschrift",
                question: "Muss ich das Wohnungs√ºbergabe-Protokoll unterschreiben?",
                answer: "Nein. Unterschreiben Sie nur, wenn Sie mit dem Inhalt vollst√§ndig einverstanden sind. Eine Unterschrift bedeutet, dass Sie die festgehaltenen M√§ngel akzeptieren. Bei Streitpunkten k√∂nnen Sie die Unterschrift verweigern oder einen Zusatz wie ‚ÄûUnterschrift gilt nicht als Schuldanerkennung‚Äú vermerken.",
                extras: ["Verlange bei Unklarheiten eine Bedenkzeit oder ein separates Gespr√§ch.", "Fotografiere strittige Stellen f√ºr deine Unterlagen."],
                sources: ["mieterverband.ch"]
              },
              {
                id: "uebergabe-druck",
                question: "Was kann ich tun, wenn ich ein Protokoll unter Druck unterschrieben habe?",
                answer: "Wenn Sie sich gezwungen f√ºhlten, k√∂nnen Sie Ihre Unterschrift schriftlich widerrufen. Senden Sie rasch einen eingeschriebenen Brief an die Vermietung und erkl√§ren Sie, dass Sie unter Irrtum oder Druck unterschrieben haben. In der Praxis werden bei Streitf√§llen oft Kompromisse gesucht.",
                extras: ["Schreibe den Widerruf m√∂glichst sofort nach der √úbergabe.", "Notiere Namen von Zeugen, die den Druck belegen k√∂nnen."],
                sources: ["mieterverband.ch"]
              }
            ]
          }
        ]
      },
      {
        id: "schaeden",
        title: "Sch√§den & Abnutzung",
        subtitle: "Reparaturen und Verantwortlichkeiten",
        icon: "üõ†Ô∏è",
        description: "Was ist normal, was ist zu bezahlen und wie wird der Zeitwert berechnet?",
        topics: [
          {
            id: "schaeden-abnutzung",
            title: "Abnutzung vs. Schaden",
            icon: "‚öñÔ∏è",
            description: "Unterschiede zwischen normaler Abnutzung und √ºberm√§ssigen Sch√§den.",
            keywords: ["Abnutzung", "Schaden", "Zeitwert", "Reparaturkosten"],
            articles: [
              {
                id: "schaeden-normal",
                question: "Was gilt als normale Abnutzung ‚Äì und f√ºr welche Sch√§den muss ich bezahlen?",
                answer: "Normale Abnutzung durch √ºblichen Gebrauch ist mit der Miete abgegolten und muss nicht bezahlt werden (z.B. leicht verblichene W√§nde, √ºbliche Kratzer). √úberm√§ssige Abnutzung oder Besch√§digungen wie Brandl√∂cher, tiefe Kratzer oder Spr√ºnge m√ºssen hingegen bezahlt werden.",
                extras: ["Achte darauf, dass Abnutzungen im Protokoll als normal vermerkt werden.", "Zeitwert und Lebensdauer sind entscheidend f√ºr die Kosten."],
                sources: ["hev-winterthur.ch", "newhome.ch"]
              },
              {
                id: "schaeden-zeitwert",
                question: "Wie wird der Zeitwert bei Sch√§den berechnet?",
                answer: "Bei einer n√∂tigen Erneuerung zahlen Sie nicht den Neupreis, sondern den Zeitwert. Die Lebensdauer der Sache wird ber√ºcksichtigt. Ist eine Wandfarbe z.B. √§lter als die √ºbliche Lebensdauer, tr√§gt der Vermieter die Kosten.",
                extras: ["Frage nach der Lebensdauertabelle, wenn Kosten verlangt werden.", "Lass dir den Berechnungsweg schriftlich erkl√§ren."],
                sources: ["mieterverband.ch", "hev-winterthur.ch"]
              }
            ]
          },
          {
            id: "schaeden-anstrich",
            title: "W√§nde, Umbauten & kleiner Unterhalt",
            icon: "üé®",
            description: "Malerarbeiten, kleine Reparaturen und R√ºckbau.",
            keywords: ["W√§nde streichen", "Umbauten", "kleiner Unterhalt", "D√ºbell√∂cher"],
            articles: [
              {
                id: "schaeden-anstrich-frage",
                question: "Muss ich W√§nde neu streichen oder f√ºr Malerarbeiten aufkommen?",
                answer: "Grunds√§tzlich wird ein neutraler weisser Anstrich erwartet, wenn nichts anderes vereinbart ist. Knallige Farben oder starke Vergilbungen k√∂nnen kostenpflichtig sein. Normale Gebrauchsspuren gelten als √ºbliche Abnutzung und m√ºssen nicht bezahlt werden.",
                extras: ["Pr√ºfe die letzte Renovation: Ist sie lange her, tr√§gt der Vermieter die Kosten.", "Ein Farbtester hilft, kleine Stellen unauff√§llig zu √ºberstreichen."],
                sources: ["newhome.ch", "swisscaution.ch"]
              },
              {
                id: "schaeden-umbauten",
                question: "Muss ich von mir durchgef√ºhrte bauliche √Ñnderungen r√ºckg√§ngig machen?",
                answer: "Umbauten ohne Zustimmung m√ºssen beim Auszug auf Wunsch des Vermieters r√ºckg√§ngig gemacht werden. Holen Sie f√ºr gr√∂ssere Ver√§nderungen immer eine schriftliche Zustimmung ein. Mit Zustimmung darf die √Ñnderung oft bleiben.",
                extras: ["Bewahre die schriftliche Zustimmung gut auf.", "R√ºckbaukosten lassen sich vermeiden, wenn du fr√ºhzeitig kl√§rst, was gew√ºnscht ist."],
                sources: ["mieterverband.ch"]
              },
              {
                id: "schaeden-unterhalt",
                question: "Was z√§hlt als ‚Äûkleiner Unterhalt‚Äú und was muss ich selbst erledigen?",
                answer: "Kleiner Unterhalt umfasst einfache, geringf√ºgige Reparaturen wie Gl√ºhbirnen ersetzen, Armaturen entkalken, Abfl√ºsse reinigen oder D√ºbell√∂cher sauber ausbessern. Arbeiten mit Fachkenntnis sind Sache des Vermieters.",
                extras: ["K√ºchen- und Badzubeh√∂r wie Dichtungen oder Duschschl√§uche gelten meist als kleiner Unterhalt.", "Halte Quittungen f√ºr Ersatzteile bereit."],
                sources: ["mieterverband.ch", "newhome.ch"]
              },
              {
                id: "schaeden-duebel",
                question: "M√ºssen D√ºbel- und Bohrl√∂cher vor dem Auszug geschlossen werden?",
                answer: "Ja. L√∂cher sollten fachgerecht zugespachtelt, geschliffen und im passenden Farbton √ºberstrichen werden, damit sie nicht mehr sichtbar sind. Sichtbar verbleibende L√∂cher gelten als Schaden und k√∂nnen verrechnet werden.",
                extras: ["F√ºr kleine L√∂cher reicht oft Fertigspachtel in Kombination mit Farbtupfern.", "Lass die Wand vollst√§ndig trocknen, bevor du √ºberstreichst."],
                sources: ["swisscaution.ch"]
              }
            ]
          },
          {
            id: "schaeden-meldung",
            title: "Meldungen & Schl√ºssel",
            icon: "üîê",
            description: "Fristen, Nachforderungen und Schl√ºsselverlust.",
            keywords: ["M√§ngelr√ºge", "Schl√ºsselverlust", "Nachforderung", "Frist"],
            articles: [
              {
                id: "schaeden-meldung-frist",
                question: "Darf der Vermieter Wochen nach dem Auszug neue Sch√§den melden?",
                answer: "M√§ngel m√ºssen bei der R√ºckgabe festgehalten und dem Mieter zeitnah mitgeteilt werden. Wird dies vers√§umt, sind Anspr√ºche in der Regel verwirkt. Versteckte M√§ngel m√ºssen sofort nach Entdeckung gemeldet werden.",
                extras: ["Bewahre das √úbergabeprotokoll und Fotos der Abgabe gut auf.", "Sp√§te Rechnungen ohne vorherige Meldung sind oft nicht zul√§ssig."],
                sources: ["mieterverband.ch"]
              },
              {
                id: "schaeden-schluessel",
                question: "Ich habe einen Wohnungsschl√ºssel verloren ‚Äì muss ich das Schloss bezahlen?",
                answer: "Wenn keine Missbrauchsgefahr besteht, reicht oft ein Ersatzschl√ºssel. Besteht ein Sicherheitsrisiko, kann der Austausch des Schliesssystems n√∂tig sein ‚Äì dabei wird der Zeitwert ber√ºcksichtigt. H√§ufig √ºbernimmt die Privathaftpflichtversicherung solche Kosten.",
                extras: ["Melde den Verlust sofort deiner Versicherung.", "Frage nach dem Alter des Schlosses f√ºr die Zeitwertberechnung."],
                sources: ["mieterverband.ch"]
              }
            ]
          }
        ]
      },
      {
        id: "kaution",
        title: "Mietkaution",
        subtitle: "Mietzinsdepot & R√ºckzahlung",
        icon: "üí∞",
        description: "Fristen und Vorgehen bei der Freigabe des Depots.",
        topics: [
          {
            id: "kaution-frist",
            title: "R√ºckzahlung & Fristen",
            icon: "‚è±Ô∏è",
            description: "Wann wird die Kaution freigegeben?",
            keywords: ["Mietkaution", "Depot", "Auszahlung", "Frist"],
            articles: [
              {
                id: "kaution-auszahlung",
                question: "Wann muss der Vermieter meine Mietkaution zur√ºckzahlen?",
                answer: "Nach ordnungsgem√§sser √úbergabe sollte das Depot zeitnah freigegeben werden. √úblich ist eine Frist von etwa 30 Tagen. Ein Teil kann zur√ºckbehalten werden, solange berechtigte Forderungen ungekl√§rt sind ‚Äì aber nur verh√§ltnism√§ssig. Sp√§testens nach 12 Monaten ohne gerichtliche Anspr√ºche k√∂nnen Sie die Auszahlung direkt bei der Bank verlangen.",
                extras: ["Pr√ºfe, ob noch eine Nebenkostenabrechnung offen ist.", "Bestehe auf einer schriftlichen Best√§tigung des R√ºckzahlungsstatus."],
                sources: ["weka.ch"]
              }
            ]
          },
          {
            id: "kaution-streit",
            title: "Wenn die Kaution blockiert wird",
            icon: "üì®",
            description: "N√§chste Schritte bei verweigerter Auszahlung.",
            keywords: ["Kaution blockiert", "Schlichtungsbeh√∂rde", "R√ºckforderung"],
            articles: [
              {
                id: "kaution-streit",
                question: "Was kann ich tun, wenn der Vermieter die Kaution nicht zur√ºckzahlt?",
                answer: "Fordern Sie die Freigabe schriftlich und setzen Sie eine Frist. Reagiert die Vermietung nicht, k√∂nnen Sie bei der Schlichtungsbeh√∂rde Klage auf R√ºckzahlung einreichen. Nach einem Jahr ohne rechtliche Schritte muss die Bank das Geld an Sie auszahlen.",
                extras: ["Sende Forderungen per Einschreiben, damit du einen Nachweis hast.", "Lege Kopien des √úbergabeprotokolls bei."],
                sources: ["mieterverband.ch"]
              }
            ]
          }
        ]
      },
      {
        id: "allgemeines",
        title: "Allgemeines",
        subtitle: "Vorbereitung & praktische Tipps",
        icon: "üìå",
        description: "Checklisten, Dokumente und reibungslose Abl√§ufe.",
        topics: [
          {
            id: "allgemeines-checkliste",
            title: "Auszugs-Checkliste",
            icon: "‚úÖ",
            description: "So beh√§ltst du den √úberblick bis zur Abgabe.",
            keywords: ["Checkliste", "Vorbereitung", "Unterlagen", "√úbergabeplan"],
            articles: [
              {
                id: "allgemeines-plan",
                question: "Welche Schritte sollte ich vor der √úbergabe zuerst planen?",
                answer: "Plane mindestens zwei Wochen Puffer f√ºr die Endreinigung, kleine Reparaturen und die Terminabstimmung. Erstelle eine Aufgabenliste f√ºr K√ºche, Bad, Fenster, B√∂den und Keller und hake erledigte Punkte ab.",
                extras: ["Teile Aufgaben auf, falls Freunde oder Familie helfen.", "Ein fixer Reinigungstag sorgt f√ºr klare Priorit√§ten."],
                sources: ["Internes Know-how"]
              },
              {
                id: "allgemeines-unterlagen",
                question: "Welche Unterlagen sollte ich bereithalten?",
                answer: "Lege Mietvertrag, √úbergabeprotokoll, Fotos des Wohnungszustands und allf√§llige Rechnungen bereit. So kannst du R√ºckfragen schnell kl√§ren.",
                extras: ["Digitale Kopien auf dem Handy sind am √úbergabetag praktisch.", "Notiere Ansprechpartner und Telefonnummern der Verwaltung."],
                sources: ["Internes Know-how"]
              }
            ]
          },
          {
            id: "allgemeines-ablauf",
            title: "Reibungslose √úbergabe",
            icon: "ü§ù",
            description: "Kommunikation und klare Absprachen.",
            keywords: ["Kommunikation", "Abnahme", "Protokoll", "√úbergabetermin"],
            articles: [
              {
                id: "allgemeines-termine",
                question: "Wie best√§tige ich Termine richtig?",
                answer: "Best√§tige √úbergabetermine schriftlich per E-Mail oder Brief und nenne ein klares Zeitfenster. So wissen beide Seiten, wann die Abnahme stattfindet.",
                extras: ["Bitte um eine kurze Best√§tigung der Vermietung.", "Speichere E-Mails oder Briefe im √úbergabeordner."],
                sources: ["Internes Know-how"]
              },
              {
                id: "allgemeines-stressfrei",
                question: "Was hilft gegen Missverst√§ndnisse bei der Abnahme?",
                answer: "Halte Absprachen schriftlich fest, dokumentiere den Zustand der Wohnung mit Fotos und bringe alle Schl√ºssel geordnet mit. Ein ruhiger, vorbereiteter Ablauf reduziert Konflikte.",
                extras: ["Eine zweite Person als Begleitung kann helfen, Details zu belegen.", "Notiere offene Punkte direkt im Protokoll."],
                sources: ["Internes Know-how"]
              }
            ]
          }
        ]
      }
    ];

    const blogSourceConfig = {
      apiUrl: "https://api.github.com/repos/EasyCleany/EasyCleany/contents/sites/help/content/blog",
      rawBaseUrl: "https://raw.githubusercontent.com/EasyCleany/EasyCleany/main/sites/help/content/blog"
    };

    const views = {
      home: document.getElementById("helpHome"),
      search: document.getElementById("helpSearch"),
      category: document.getElementById("helpCategory"),
      article: document.getElementById("helpArticle")
    };
    const categoryGrid = document.getElementById("categoryGrid");
    const categoryTabs = document.getElementById("categoryTabs");
    const subcategoryGrid = document.getElementById("subcategoryGrid");
    const categoryTitle = document.getElementById("categoryTitle");
    const categorySubtitle = document.getElementById("categorySubtitle");
    const articleContent = document.getElementById("articleContent");
    const articleNav = document.getElementById("articleNav");
    const backToHome = document.getElementById("backToHome");
    const backToCategory = document.getElementById("backToCategory");
    const searchInput = document.getElementById("searchInput");
    const searchBtn = document.getElementById("searchBtn");
    const searchSuggestions = document.getElementById("searchSuggestions");
    const searchResults = document.getElementById("searchResults");
    const searchResultsMeta = document.getElementById("searchResultsMeta");
    const searchResultsTitle = document.getElementById("searchResultsTitle");
    const searchResultsMore = document.getElementById("searchResultsMore");
    const goToOverview = document.getElementById("goToOverview");
    const searchRequest = document.getElementById("searchRequest");
    const openSearchRequest = document.getElementById("openSearchRequest");
    const searchRequestForm = document.getElementById("searchRequestForm");
    const submitSearchRequest = document.getElementById("submitSearchRequest");
    const cancelSearchRequest = document.getElementById("cancelSearchRequest");
    const requestTitle = document.getElementById("requestTitle");
    const requestEmail = document.getElementById("requestEmail");
    const requestDescription = document.getElementById("requestDescription");

    let activeCategory = null;
    let searchIndex = [];
    let lastSearchQuery = "";
    let articleBackTarget = "category";
    let searchExpanded = false;

    const showView = (viewName) => {
      Object.values(views).forEach(view => view.classList.remove("active"));
      views[viewName].classList.add("active");
    };

    const addArticlesToTopic = (topicId, newArticles) => {
      helpData.forEach(category => {
        category.topics.forEach(topic => {
          if (topic.id !== topicId) return;
          const existingIds = new Set(topic.articles.map(article => article.id));
          const existingQuestions = new Set(topic.articles.map(article => article.question));
          newArticles.forEach(article => {
            if (existingIds.has(article.id) || existingQuestions.has(article.question)) {
              return;
            }
            topic.articles.push(article);
            existingIds.add(article.id);
            existingQuestions.add(article.question);
          });
        });
      });
    };

    const parseFrontmatter = (content) => {
      const match = content.match(/^---\s*\n([\s\S]*?)\n---\s*\n?/);
      if (!match) {
        return { data: {}, body: content };
      }
      const data = {};
      const body = content.slice(match[0].length);
      match[1].split(/\r?\n/).forEach(line => {
        const trimmed = line.trim();
        if (!trimmed || trimmed.startsWith("#")) return;
        const sep = trimmed.indexOf(":");
        if (sep === -1) return;
        const key = trimmed.slice(0, sep).trim();
        let value = trimmed.slice(sep + 1).trim();
        if (!value) return;
        if ((value.startsWith("\"") && value.endsWith("\"")) || (value.startsWith("'") && value.endsWith("'"))) {
          value = value.slice(1, -1);
        } else if (value.startsWith("[") && value.endsWith("]")) {
          try {
            value = JSON.parse(value.replace(/'/g, "\""));
          } catch {
            value = value.slice(1, -1).split(",").map(item => item.trim());
          }
        }
        data[key] = value;
      });
      return { data, body };
    };

    const stripMarkdown = (markdown) => {
      return String(markdown || "")
        .replace(/```[\s\S]*?```/g, " ")
        .replace(/`[^`]*`/g, " ")
        .replace(/!\[[^\]]*\]\([^)]+\)/g, " ")
        .replace(/\[[^\]]*\]\([^)]+\)/g, " ")
        .replace(/[#>*_~\-]/g, " ")
        .replace(/\s+/g, " ")
        .trim();
    };

    const formatMarkdownHtml = (markdown) => {
      const blocks = String(markdown || "").split(/\n\s*\n/);
      const html = [];
      blocks.forEach(block => {
        const trimmed = block.trim();
        if (!trimmed) return;
        const headingMatch = trimmed.match(/^(#{1,3})\s+(.*)$/);
        if (headingMatch) {
          const level = headingMatch[1].length === 1 ? "h2" : "h3";
          html.push(`<${level}>${stripMarkdown(headingMatch[2])}</${level}>`);
          return;
        }
        const lines = trimmed.split(/\r?\n/).map(line => line.trim()).filter(Boolean);
        const isList = lines.every(line => /^(\d+\.)|[-*]\s+/.test(line));
        if (isList) {
          const items = lines.map(line => line.replace(/^(\d+\.)|[-*]\s+/, ""));
          const listItems = items.map(item => `<li>${stripMarkdown(item)}</li>`).join("");
          const isOrdered = lines.some(line => /^\d+\./.test(line));
          html.push(isOrdered ? `<ol>${listItems}</ol>` : `<ul>${listItems}</ul>`);
          return;
        }
        html.push(`<p>${stripMarkdown(trimmed)}</p>`);
      });
      return html.join("");
    };

    const buildSummary = (text) => {
      if (!text) return "";
      const clipped = text.slice(0, 320);
      const end = clipped.lastIndexOf(".");
      return (end > 120 ? clipped.slice(0, end + 1) : clipped).trim();
    };

    const parseBlogMarkdown = (filename, content) => {
      const { data, body } = parseFrontmatter(content);
      const cleanBody = stripMarkdown(body);
      const title = data.title || filename.replace(/\.md$/, "");
      const summary = data.summary || buildSummary(cleanBody);
      return {
        id: `blog-${filename.replace(/\.md$/, "")}`,
        question: title,
        answer: cleanBody || "Dieser Beitrag wird demn√§chst erg√§nzt.",
        answerHtml: formatMarkdownHtml(body),
        fullText: cleanBody,
        summary,
        answer: summary || "Dieser Beitrag wird demn√§chst erg√§nzt.",
        fullText: cleanBody,
        keywords: Array.isArray(data.keywords) ? data.keywords : [],
        extras: [],
        sources: ["EasyCleany Blog"]
      };
    };

    const loadBlogArticles = async () => {
      try {
        const cacheBuster = Date.now();
        const response = await fetch(`${blogSourceConfig.apiUrl}?t=${cacheBuster}`, { cache: "no-store" });
        if (!response.ok) return;
        const files = await response.json();
        const markdownFiles = files.filter(file => file.name.endsWith(".md"));
        const articles = [];
        for (const file of markdownFiles) {
          const rawUrl = `${blogSourceConfig.rawBaseUrl}/${file.name}?t=${cacheBuster}`;
          const markdownResponse = await fetch(rawUrl, { cache: "no-store" });
          if (!markdownResponse.ok) continue;
          const markdownText = await markdownResponse.text();
          articles.push(parseBlogMarkdown(file.name, markdownText));
        }
        addArticlesToTopic("schaeden-anstrich", articles);
      } catch (error) {
        console.warn("Blog-Artikel konnten nicht geladen werden.", error);
      }
    };

    const scrollToElement = (element) => {
      if (!element) return;
      const offset = 120;
      requestAnimationFrame(() => {
        const top = element.getBoundingClientRect().top + window.scrollY - offset;
        window.scrollTo({ top, behavior: "smooth" });
      });
    };

    const renderHome = () => {
      categoryGrid.innerHTML = helpData.map(category => `
        <button class="category-card" data-category="${category.id}" type="button">
          <span class="category-icon">${category.icon}</span>
          <h3>${category.title}</h3>
          <p>${category.subtitle}</p>
        </button>
      `).join("");

      categoryGrid.querySelectorAll("button").forEach(button => {
        button.addEventListener("click", () => {
          const categoryId = button.dataset.category;
          const category = helpData.find(item => item.id === categoryId);
          renderCategory(category);
        });
      });
    };

    const renderCategoryTabs = (categoryId) => {
      categoryTabs.innerHTML = `<h4>Kategorien</h4>` + helpData.map(category => `
        <div class="category-tab ${category.id === categoryId ? "active" : ""}" data-category="${category.id}">
          <span>${category.icon}</span>
          <span>${category.title}</span>
        </div>
      `).join("");

      categoryTabs.querySelectorAll(".category-tab").forEach(tab => {
        tab.addEventListener("click", () => {
          const newCategory = helpData.find(item => item.id === tab.dataset.category);
          renderCategory(newCategory);
        });
      });
    };

    const renderCategory = (category) => {
      activeCategory = category;
      articleBackTarget = "category";
      categoryTitle.textContent = category.title;
      categorySubtitle.textContent = category.description;
      renderCategoryTabs(category.id);
      subcategoryGrid.innerHTML = category.topics.map(topic => {
        const sections = [];
        for (let i = 0; i < topic.articles.length; i += 5) {
          const chunk = topic.articles.slice(i, i + 5);
          const titleSuffix = Math.floor(i / 5) + 1;
          sections.push({
            id: `${topic.id}-section-${titleSuffix}`,
            title: `${topic.title} ‚Äì Abschnitt ${titleSuffix}`,
            articles: chunk
          });
        }
        const sectionsMarkup = sections.map((section, index) => `
          <div class="subcat-section ${index > 0 ? "is-hidden" : ""}" data-section="${section.id}">
            <div class="subcat-section-title">${section.title}</div>
            <ul class="subcat-list">
              ${section.articles.map(article => `
                <li><button class="link-btn subcat-link" data-topic="${topic.id}" data-article="${article.id}" type="button">${article.question}</button></li>
              `).join("")}
            </ul>
          </div>
        `).join("");
        const toggleMarkup = sections.length > 1
          ? `<button class="subcat-toggle" data-topic="${topic.id}" type="button">Mehr anzeigen ‚Üì</button>`
          : "";
        return `
        <div class="subcat-card" data-topic="${topic.id}">
          <span class="subcat-icon">${topic.icon}</span>
          <h3>${topic.title}</h3>
          <p>${topic.description}</p>
          ${sectionsMarkup}
          ${toggleMarkup}
        </div>
      `;
      }).join("");

      subcategoryGrid.querySelectorAll(".subcat-link").forEach(button => {
        button.addEventListener("click", () => {
          const topic = category.topics.find(item => item.id === button.dataset.topic);
          const article = topic.articles.find(item => item.id === button.dataset.article);
          renderArticle(category, topic, article);
        });
      });
      subcategoryGrid.querySelectorAll(".subcat-toggle").forEach(toggle => {
        toggle.addEventListener("click", () => {
          const card = toggle.closest(".subcat-card");
          const sections = card.querySelectorAll(".subcat-section");
          const expanded = toggle.dataset.expanded === "true";
          sections.forEach((section, index) => {
            if (index === 0) return;
            section.classList.toggle("is-hidden", expanded);
          });
          toggle.dataset.expanded = expanded ? "false" : "true";
          toggle.textContent = expanded ? "Mehr anzeigen ‚Üì" : "Weniger anzeigen ‚Üë";
        });
      });

      showView("category");
      scrollToElement(views.category.querySelector(".toolbar"));
    };

    const renderArticle = (category, topic, article) => {
      if (article.likes === undefined) {
        article.likes = 0;
      }
      if (articleBackTarget === "search") {
        backToCategory.textContent = "‚Üê Zur√ºck zu den Suchergebnissen";
      } else {
        backToCategory.textContent = "‚Üê Zur√ºck zur Kategorie";
      }
      const sourceLinks = article.sources.map((source, index) => `
        <a class="source-pill" href="#source-${index}">${source}</a>
      `).join("");

      const extrasMarkup = article.extras && article.extras.length
        ? `
          <div class="article-section" id="section-extras">
            <h3>Zusatzinfos</h3>
            <ul>
              ${article.extras.map(item => `<li>${item}</li>`).join("")}
            </ul>
          </div>
        `
        : "";

      const sourcesMarkup = `
        <div class="article-section" id="section-sources">
          <h3>Quellen</h3>
          <ul>
            ${article.sources.map((source, index) => `<li id="source-${index}">${source}</li>`).join("")}
          </ul>
        </div>
      `;
      const answerMarkup = article.answerHtml
        ? article.answerHtml
        : `<p>${article.answer}</p>`;

      articleContent.innerHTML = `
        <div class="breadcrumb">
          <button class="link-btn breadcrumb-link" data-action="home" type="button">Help Center</button>
          <span>‚Ä¢</span>
          <button class="link-btn breadcrumb-link" data-action="category" type="button">${category.title}</button>
          <span>‚Ä¢</span>
          <button class="link-btn breadcrumb-link" data-action="topic" type="button">${topic.title}</button>
          <span class="pill">Kategorie: ${category.title}</span>
        </div>
        <div class="article-header">
          <h2>${article.question}</h2>
          <div class="like-counter" id="likeCounter">üíú ${article.likes}</div>
        </div>
        <p>${topic.description}</p>
        <div class="source-bar">
          <span>Quellen:</span>
          <div class="source-links">
            ${sourceLinks}
          </div>
        </div>
        <div class="article-section" id="section-answer">
          <h3>Antwort</h3>
          ${answerMarkup}
        </div>
        ${extrasMarkup}
        ${sourcesMarkup}
        <div class="feedback" id="feedback">
          <h4>War der Artikel hilfreich?</h4>
          <div class="feedback-actions">
            <button class="btn btn-primary" data-feedback="yes" type="button">Ja klar</button>
            <button class="btn btn-outline" data-feedback="no" type="button">Nicht wirklich</button>
          </div>
          <div class="feedback-quick" id="feedbackQuick" style="display:none;">
            <input type="text" placeholder="Optional: kurzer Kommentar" />
            <button class="btn btn-primary" type="button">Feedback senden</button>
          </div>
          <div class="feedback-thanks" id="feedbackThanks" style="display:none;">Danke! Dein Feedback hilft uns, die Inhalte weiter zu verbessern.</div>
          <form class="feedback-form" id="feedbackForm" style="display:none;">
            <div class="feedback-options">
              <label><input type="radio" name="feedbackReason" /> Dieser Artikel hat meine Fragen nicht beantwortet</label>
              <label><input type="radio" name="feedbackReason" /> Ich fand diesen Artikel verwirrend oder schwer lesbar</label>
              <label><input type="radio" name="feedbackReason" /> Mir gef√§llt nicht, wie der Ablauf erkl√§rt wurde</label>
              <label><input type="radio" name="feedbackReason" /> Sonstiges</label>
            </div>
            <textarea placeholder="Gibt es noch etwas, das du uns mitteilen m√∂chtest?"></textarea>
            <button class="btn btn-primary" type="button">Feedback senden</button>
          </form>
        </div>
      `;

      articleNav.innerHTML = `
        <h4>In diesem Artikel</h4>
        <a href="#section-answer">Antwort</a>
        ${article.extras && article.extras.length ? `<a href="#section-extras">Zusatzinfos</a>` : ""}
        <a href="#section-sources">Quellen</a>
      `;

      const feedbackButtons = articleContent.querySelectorAll("[data-feedback]");
      const feedbackForm = articleContent.querySelector("#feedbackForm");
      const feedbackThanks = articleContent.querySelector("#feedbackThanks");
      const feedbackQuick = articleContent.querySelector("#feedbackQuick");
      const feedbackActions = articleContent.querySelector(".feedback-actions");
      const likeCounter = articleContent.querySelector("#likeCounter");
      articleContent.querySelectorAll(".breadcrumb-link").forEach(link => {
        link.addEventListener("click", () => {
          const action = link.dataset.action;
          if (action === "home") {
            showView("home");
            scrollToElement(categoryGrid);
            return;
          }
          renderCategory(category);
        });
      });

      articleContent.querySelectorAll(".source-pill").forEach(pill => {
        pill.addEventListener("click", (event) => {
          event.preventDefault();
          const target = articleContent.querySelector(pill.getAttribute("href"));
          scrollToElement(target);
        });
      });

      articleNav.querySelectorAll("a").forEach(link => {
        link.addEventListener("click", (event) => {
          event.preventDefault();
          const target = articleContent.querySelector(link.getAttribute("href"));
          scrollToElement(target);
        });
      });

      feedbackButtons.forEach(button => {
        button.addEventListener("click", () => {
          const value = button.dataset.feedback;
          if (value === "yes") {
            article.likes += 1;
            likeCounter.textContent = `üíú ${article.likes}`;
            feedbackActions.style.display = "none";
            feedbackQuick.style.display = "grid";
            feedbackThanks.style.display = "none";
            feedbackForm.style.display = "none";
          } else {
            feedbackActions.style.display = "none";
            feedbackQuick.style.display = "none";
            feedbackThanks.style.display = "none";
            feedbackForm.style.display = "grid";
          }
        });
      });

      showView("article");
      scrollToElement(views.article.querySelector(".toolbar"));
    };

    const buildSearchIndex = () => {
      searchIndex = helpData.flatMap(category => category.topics.flatMap(topic => topic.articles.map(article => {
        const keywordText = (topic.keywords || []).join(" ").toLowerCase();
        const articleKeywords = (article.keywords || []).join(" ").toLowerCase();
        const extrasText = (article.extras || []).join(" ").toLowerCase();
        const fullText = (article.fullText || "").toLowerCase();
        const snippetText = article.summary || article.answer || "";
        return {
          category,
          topic,
          article,
          question: article.question.toLowerCase(),
          topicTitle: topic.title.toLowerCase(),
          keywordText,
          bodyText: `${article.answer} ${fullText} ${extrasText}`.toLowerCase(),
          content: `${category.title} ${category.subtitle} ${topic.title} ${topic.description} ${keywordText} ${articleKeywords} ${article.question} ${article.answer} ${fullText} ${extrasText}`.toLowerCase(),
          snippet: snippetText || buildSummary(article.fullText || "")
          snippet: article.answer || buildSummary(article.fullText || "")
        };
      })));
    };

    const matchResults = (query) => {
      const terms = query.toLowerCase().split(/\s+/).filter(Boolean);
      if (!terms.length) return [];
      return searchIndex
        .map(item => {
          const score = terms.reduce((total, term) => {
            if (!item.content.includes(term)) {
              return total;
            }
            const inQuestion = item.question.includes(term) ? 3 : 0;
            const inTopic = item.topicTitle.includes(term) ? 2 : 0;
            const inKeywords = item.keywordText.includes(term) ? 2 : 0;
            const inBody = item.bodyText.includes(term) ? 1 : 0;
            return total + inQuestion + inTopic + inKeywords + inBody;
          }, 0);
          return { ...item, score };
        })
        .filter(item => item.score > 0)
        .sort((a, b) => b.score - a.score);
    };

    const renderSuggestions = (query) => {
      const results = matchResults(query).slice(0, 4);
      if (!results.length) {
        searchSuggestions.classList.remove("active");
        searchSuggestions.innerHTML = "";
        return;
      }
      searchSuggestions.classList.add("active");
      searchSuggestions.innerHTML = results.map(result => `
        <div class="search-suggestion" data-category="${result.category.id}" data-topic="${result.topic.id}" data-article="${result.article.id}">
          <strong>${result.article.question}</strong>
          <span class="category-tag" data-category="${result.category.id}">${result.category.title}</span>
        </div>
      `).join("");
      searchSuggestions.querySelectorAll(".search-suggestion").forEach(item => {
        item.addEventListener("click", () => {
          const category = helpData.find(entry => entry.id === item.dataset.category);
          const topic = category.topics.find(entry => entry.id === item.dataset.topic);
          const article = topic.articles.find(entry => entry.id === item.dataset.article);
          renderArticle(category, topic, article);
          searchSuggestions.classList.remove("active");
        });
      });
    };

    const renderSearchResults = (query) => {
      const results = matchResults(query);
      if (query !== lastSearchQuery) {
        searchExpanded = false;
      }
      lastSearchQuery = query;
      articleBackTarget = "search";
      searchResultsMeta.textContent = results.length
        ? `${results.length} passende Artikel f√ºr ‚Äû${query}‚Äú`
        : `Keine Treffer f√ºr ‚Äû${query}‚Äú`;
      const visibleResults = searchExpanded ? results : results.slice(0, 8);
      searchResults.innerHTML = visibleResults.map(result => `
        <div class="search-result-card" data-category="${result.category.id}" data-topic="${result.topic.id}" data-article="${result.article.id}">
          <h3>${result.article.question}</h3>
          <span class="category-tag" data-category="${result.category.id}">${result.category.title}</span>
          <p>${result.snippet}</p>
        </div>
      `).join("");
      searchResults.querySelectorAll(".search-result-card").forEach(card => {
        card.addEventListener("click", () => {
          const category = helpData.find(entry => entry.id === card.dataset.category);
          const topic = category.topics.find(entry => entry.id === card.dataset.topic);
          const article = topic.articles.find(entry => entry.id === card.dataset.article);
          renderArticle(category, topic, article);
        });
      });
      if (results.length > 8) {
        searchResultsMore.innerHTML = `
          <button class="btn btn-outline search-results-toggle" type="button">
            ${searchExpanded ? "Weniger anzeigen ‚Üë" : "Mehr anzeigen ‚Üì"}
          </button>
        `;
        const toggle = searchResultsMore.querySelector("button");
        toggle.addEventListener("click", () => {
          searchExpanded = !searchExpanded;
          renderSearchResults(query);
        });
      } else {
        searchResultsMore.innerHTML = "";
      }
      showView("search");
      scrollToElement(searchResultsTitle);
    };

    const handleSearchSubmit = () => {
      const query = searchInput.value.trim();
      if (!query) {
        showView("home");
        return;
      }
      searchExpanded = false;
      renderSearchResults(query);
      searchSuggestions.classList.remove("active");
    };

    backToHome.addEventListener("click", () => showView("home"));
    backToCategory.addEventListener("click", () => {
      if (articleBackTarget === "search") {
        showView("search");
        scrollToElement(searchResultsTitle);
      } else {
        renderCategory(activeCategory);
      }
    });
    searchInput.addEventListener("input", (event) => renderSuggestions(event.target.value));
    searchInput.addEventListener("keydown", (event) => {
      if (event.key === "Enter") {
        event.preventDefault();
        handleSearchSubmit();
      }
    });
    searchBtn.addEventListener("click", handleSearchSubmit);
    goToOverview.addEventListener("click", () => showView("home"));
    openSearchRequest.addEventListener("click", () => {
      const queryText = lastSearchQuery ? `Ich habe gesucht nach: ${lastSearchQuery}.` : "Ich habe keine passende Antwort gefunden.";
      requestDescription.value = `${queryText}\n\nMeine Frage:`.trim();
      searchRequestForm.style.display = "grid";
      openSearchRequest.style.display = "none";
      scrollToElement(searchRequest);
    });
    cancelSearchRequest.addEventListener("click", () => {
      searchRequestForm.style.display = "none";
      openSearchRequest.style.display = "inline-flex";
    });
    submitSearchRequest.addEventListener("click", () => {
      const title = requestTitle.value.trim();
      const email = requestEmail.value.trim();
      const description = requestDescription.value.trim();
      const subject = encodeURIComponent(`Help Anfrage: ${title || "Neue Anfrage"}`);
      const body = encodeURIComponent(`Titel: ${title || "-"}\nE-Mail: ${email || "-"}\n\nBeschreibung:\n${description || "-"}`);
      window.location.href = `mailto:easycleany@outlook.com?subject=${subject}&body=${body}`;
    });

    const initializeHelp = async () => {
      await loadBlogArticles();
      buildSearchIndex();
      renderHome();
    };

    initializeHelp();
  </script>
</body>
</html>
